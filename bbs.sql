/*
Navicat MySQL Data Transfer

Source Server         : mydata
Source Server Version : 50722
Source Host           : localhost:3306
Source Database       : bbs

Target Server Type    : MYSQL
Target Server Version : 50722
File Encoding         : 65001

Date: 2018-11-12 17:20:34
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for `auth_group`
-- ----------------------------
DROP TABLE IF EXISTS `auth_group`;
CREATE TABLE `auth_group` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(80) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of auth_group
-- ----------------------------

-- ----------------------------
-- Table structure for `auth_group_permissions`
-- ----------------------------
DROP TABLE IF EXISTS `auth_group_permissions`;
CREATE TABLE `auth_group_permissions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `group_id` int(11) NOT NULL,
  `permission_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `auth_group_permissions_group_id_permission_id_0cd325b0_uniq` (`group_id`,`permission_id`),
  KEY `auth_group_permissio_permission_id_84c5c92e_fk_auth_perm` (`permission_id`),
  CONSTRAINT `auth_group_permissio_permission_id_84c5c92e_fk_auth_perm` FOREIGN KEY (`permission_id`) REFERENCES `auth_permission` (`id`),
  CONSTRAINT `auth_group_permissions_group_id_b120cbf9_fk_auth_group_id` FOREIGN KEY (`group_id`) REFERENCES `auth_group` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of auth_group_permissions
-- ----------------------------

-- ----------------------------
-- Table structure for `auth_permission`
-- ----------------------------
DROP TABLE IF EXISTS `auth_permission`;
CREATE TABLE `auth_permission` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `content_type_id` int(11) NOT NULL,
  `codename` varchar(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `auth_permission_content_type_id_codename_01ab375a_uniq` (`content_type_id`,`codename`),
  CONSTRAINT `auth_permission_content_type_id_2f476e4b_fk_django_co` FOREIGN KEY (`content_type_id`) REFERENCES `django_content_type` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of auth_permission
-- ----------------------------
INSERT INTO `auth_permission` VALUES ('1', 'Can add log entry', '1', 'add_logentry');
INSERT INTO `auth_permission` VALUES ('2', 'Can change log entry', '1', 'change_logentry');
INSERT INTO `auth_permission` VALUES ('3', 'Can delete log entry', '1', 'delete_logentry');
INSERT INTO `auth_permission` VALUES ('4', 'Can add permission', '2', 'add_permission');
INSERT INTO `auth_permission` VALUES ('5', 'Can change permission', '2', 'change_permission');
INSERT INTO `auth_permission` VALUES ('6', 'Can delete permission', '2', 'delete_permission');
INSERT INTO `auth_permission` VALUES ('7', 'Can add group', '3', 'add_group');
INSERT INTO `auth_permission` VALUES ('8', 'Can change group', '3', 'change_group');
INSERT INTO `auth_permission` VALUES ('9', 'Can delete group', '3', 'delete_group');
INSERT INTO `auth_permission` VALUES ('10', 'Can add content type', '4', 'add_contenttype');
INSERT INTO `auth_permission` VALUES ('11', 'Can change content type', '4', 'change_contenttype');
INSERT INTO `auth_permission` VALUES ('12', 'Can delete content type', '4', 'delete_contenttype');
INSERT INTO `auth_permission` VALUES ('13', 'Can add session', '5', 'add_session');
INSERT INTO `auth_permission` VALUES ('14', 'Can change session', '5', 'change_session');
INSERT INTO `auth_permission` VALUES ('15', 'Can delete session', '5', 'delete_session');
INSERT INTO `auth_permission` VALUES ('16', 'Can add 用户信息', '6', 'add_userinfo');
INSERT INTO `auth_permission` VALUES ('17', 'Can change 用户信息', '6', 'change_userinfo');
INSERT INTO `auth_permission` VALUES ('18', 'Can delete 用户信息', '6', 'delete_userinfo');
INSERT INTO `auth_permission` VALUES ('19', 'Can add 文章', '7', 'add_article');
INSERT INTO `auth_permission` VALUES ('20', 'Can change 文章', '7', 'change_article');
INSERT INTO `auth_permission` VALUES ('21', 'Can delete 文章', '7', 'delete_article');
INSERT INTO `auth_permission` VALUES ('22', 'Can add 文章-标签', '8', 'add_article2tag');
INSERT INTO `auth_permission` VALUES ('23', 'Can change 文章-标签', '8', 'change_article2tag');
INSERT INTO `auth_permission` VALUES ('24', 'Can delete 文章-标签', '8', 'delete_article2tag');
INSERT INTO `auth_permission` VALUES ('25', 'Can add 文章详情', '9', 'add_articledetail');
INSERT INTO `auth_permission` VALUES ('26', 'Can change 文章详情', '9', 'change_articledetail');
INSERT INTO `auth_permission` VALUES ('27', 'Can delete 文章详情', '9', 'delete_articledetail');
INSERT INTO `auth_permission` VALUES ('28', 'Can add 点赞', '10', 'add_articleupdown');
INSERT INTO `auth_permission` VALUES ('29', 'Can change 点赞', '10', 'change_articleupdown');
INSERT INTO `auth_permission` VALUES ('30', 'Can delete 点赞', '10', 'delete_articleupdown');
INSERT INTO `auth_permission` VALUES ('31', 'Can add 博客', '11', 'add_blog');
INSERT INTO `auth_permission` VALUES ('32', 'Can change 博客', '11', 'change_blog');
INSERT INTO `auth_permission` VALUES ('33', 'Can delete 博客', '11', 'delete_blog');
INSERT INTO `auth_permission` VALUES ('34', 'Can add 文章分类', '12', 'add_category');
INSERT INTO `auth_permission` VALUES ('35', 'Can change 文章分类', '12', 'change_category');
INSERT INTO `auth_permission` VALUES ('36', 'Can delete 文章分类', '12', 'delete_category');
INSERT INTO `auth_permission` VALUES ('37', 'Can add 评论', '13', 'add_comment');
INSERT INTO `auth_permission` VALUES ('38', 'Can change 评论', '13', 'change_comment');
INSERT INTO `auth_permission` VALUES ('39', 'Can delete 评论', '13', 'delete_comment');
INSERT INTO `auth_permission` VALUES ('40', 'Can add 标签', '14', 'add_tag');
INSERT INTO `auth_permission` VALUES ('41', 'Can change 标签', '14', 'change_tag');
INSERT INTO `auth_permission` VALUES ('42', 'Can delete 标签', '14', 'delete_tag');

-- ----------------------------
-- Table structure for `blog_article`
-- ----------------------------
DROP TABLE IF EXISTS `blog_article`;
CREATE TABLE `blog_article` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(50) NOT NULL,
  `desc` varchar(255) NOT NULL,
  `create_time` datetime(6) NOT NULL,
  `category_id` int(11) DEFAULT NULL,
  `user_id` int(11) NOT NULL,
  `comment_count` int(11) NOT NULL,
  `down_count` int(11) NOT NULL,
  `up_count` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `blog_article_category_id_7e38f15e_fk_blog_category_id` (`category_id`),
  KEY `blog_article_user_id_5beb0cc1_fk_blog_userinfo_id` (`user_id`),
  CONSTRAINT `blog_article_category_id_7e38f15e_fk_blog_category_id` FOREIGN KEY (`category_id`) REFERENCES `blog_category` (`id`),
  CONSTRAINT `blog_article_user_id_5beb0cc1_fk_blog_userinfo_id` FOREIGN KEY (`user_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_article
-- ----------------------------
INSERT INTO `blog_article` VALUES ('1', 'String 的常用操作', 'String 类，我可以不负责的说在 Java 中这个类应该是使用最频繁的类了。然而关于它的常用的操作，我却不甚了解。整理这个东西很反人性的，这些方法，你看到他的时候感觉很简单，但是真正用的时候还是不太会，还是会借助网络，今天我就来强行整理一波，不求全，但求精。 先说说 String 对象的构造器， ...', '2017-08-15 02:25:36.282976', '1', '7', '0', '2', '0');
INSERT INTO `blog_article` VALUES ('2', '一个程序员的自白（浅水淹人）', '他曾说过，他是一个不断思考的人，但却不懂得如何去思考。这都是事实，因为他已经深深地感受和体会到他自身各种处事的心态控制着他身体上每一个细胞的内分泌、每一滴血液的流动和每一个情绪的起伏。处理一个家庭琐事，他可以；接受朋友的一个小小请求，他乐意；解决一个工作事务，他肯定没问题；当这些事情接踵而来的时候， ...', '2018-08-15 02:26:48.439000', '1', '7', '28', '0', '2');
INSERT INTO `blog_article` VALUES ('3', '如何快速分析出现性能问题的Linux服务器', 'Brendan Gregg曾经分享过当遇到一个系统性能问题时，如何利用登录的前60秒对系统的性能情况做一个快速浏览和分析，主要包括如下10个工具，这是一个非常有用且有效的命工具列表。本文将详细介绍这些命令及其扩展选项的意义，及其在实践中的作用。 ...', '2017-08-15 12:18:12.333000', '3', '4', '0', '0', '1');
INSERT INTO `blog_article` VALUES ('4', '入门系列之在Ubuntu上使用Netdata设置实时性能监控', '欢迎大家前往腾讯云+社区，获取更多腾讯海量技术实践干货哦~ 本文由 \"小翼 \" 发表于 \"云+社区专栏\" 介绍 \"Netdata\" 通过可扩展的Web仪表板提供准确的性能监控，可以显示Linux系统上的流程和服务。它监控有关CPU，内存，磁盘，网络，进程等的指标。 Netdata一旦安装就不需要额外 ...', '2018-08-15 12:18:43.158842', '3', '4', '0', '0', '1');
INSERT INTO `blog_article` VALUES ('5', '将进酒', '\n将进酒⑴\n\n\n\n\n\n\n\n\n\n\n\n\n君不见，黄河之水天上来，奔流到海不复回。\r\n\n\r\n	君不见，高堂明镜悲白发，朝如青丝暮成雪。\r\n\n\r\n	人生得意须尽欢，莫使金樽空对月。\r\n\n\r\n	天生我材必有用，千金散尽还复来。\r\n\n\r\n	烹羊宰牛且为乐，会须一饮三百杯。\r\n\n\r\n	岑夫子，丹丘生，将进酒，杯莫', '2018-08-21 17:36:29.232811', '2', '7', '0', '0', '2');

-- ----------------------------
-- Table structure for `blog_article2tag`
-- ----------------------------
DROP TABLE IF EXISTS `blog_article2tag`;
CREATE TABLE `blog_article2tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `article_id` int(11) NOT NULL,
  `tag_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `blog_article2tag_article_id_tag_id_b0745f42_uniq` (`article_id`,`tag_id`),
  KEY `blog_article2tag_tag_id_389b9a96_fk_blog_tag_id` (`tag_id`),
  CONSTRAINT `blog_article2tag_article_id_753a2b60_fk_blog_article_id` FOREIGN KEY (`article_id`) REFERENCES `blog_article` (`id`),
  CONSTRAINT `blog_article2tag_tag_id_389b9a96_fk_blog_tag_id` FOREIGN KEY (`tag_id`) REFERENCES `blog_tag` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_article2tag
-- ----------------------------
INSERT INTO `blog_article2tag` VALUES ('2', '1', '1');
INSERT INTO `blog_article2tag` VALUES ('1', '2', '2');
INSERT INTO `blog_article2tag` VALUES ('3', '3', '4');
INSERT INTO `blog_article2tag` VALUES ('4', '4', '3');

-- ----------------------------
-- Table structure for `blog_articledetail`
-- ----------------------------
DROP TABLE IF EXISTS `blog_articledetail`;
CREATE TABLE `blog_articledetail` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `content` longtext NOT NULL,
  `article_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `article_id` (`article_id`),
  CONSTRAINT `blog_articledetail_article_id_56993a97_fk_blog_article_id` FOREIGN KEY (`article_id`) REFERENCES `blog_article` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_articledetail
-- ----------------------------
INSERT INTO `blog_articledetail` VALUES ('1', '<div class=\"postBody\">\r\n			<div id=\"cnblogs_post_body\" class=\"blogpost-body\"><p>　　写到这里，基本的ORM功能就完成了，不知大家有没有发现，这个ORM每个方法都是在with中执行的，也就是说每个方法都是一个完整的事务，当它执行完成以后也会将事务提交，那么如果我们想要进行一个复杂的事务时，它并不能做到，所以我们还需要对它进行改造，让它支持sql事务。</p>\r\n<p>　　那么应该怎么实现呢？我们都知道要支持事务，就必须让不同的sql语句在同一个事务中执行，也就是说，我们需要在一个with中执行所有的sql语句，失败则回滚，成功再提交事务。</p>\r\n<p>　　由于我们的逻辑层各个类都是继承ORM基类来实现的，而事务的开关放在各个类中就不合适，可能会存在问题，所以在执行事务时，直接调用db_helper模块，使用with初始化好数据库链接，然后在方法里编写并执行各个sql语句。</p>\r\n<p>　　当前逻辑层基类（ORM模块）的sql语句都是在方法中生成（拼接）的，然后在方法的with模块中执行，所以我们需要再次对整个类进行改造，将所有的sql生成方法提炼出来，成为单独的方法，然后在事务中，我们不直接执行获取结果，而是通过ORM生成对应的sql语句，在with中执行这样语句。（当然还有其他方法也能实现事务，不过在这里不做进一步的探讨，因为当前这种是最简单实现事务的方式之一，多层封装处理，有可能会导致系统变的更加复杂，代码更加难懂）</p>\r\n<p>　　代码改造起来很简单，比如说获取记录方法</p>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #008080;\"> 1</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model(self, wheres):\r\n</span><span style=\"color: #008080;\"> 2</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过条件获取一条记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 3</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有条件，则自动添加where</span>\r\n<span style=\"color: #008080;\"> 4</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\"> 5</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\"> 6</span> \r\n<span style=\"color: #008080;\"> 7</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 合成sql语句</span>\r\n<span style=\"color: #008080;\"> 8</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">select %(column_name_list)s from %(table_name)s %(wheres)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\"> 9</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name_list</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__column_name_list</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\">10</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初化化数据库链接</span>\r\n<span style=\"color: #008080;\">11</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">12</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">13</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0]\r\n</span><span style=\"color: #008080;\">14</span>         <span style=\"color: #0000ff;\">return</span> {}</pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>　　我们可以将它拆分成get_model_sql()和get_model()两个方法，一个处理sql组合，一个执行获取结果，前者可以给事务调用，后者直接给对应的程序调用</p>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #008080;\"> 1</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model_sql(self, wheres):\r\n</span><span style=\"color: #008080;\"> 2</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过条件获取一条记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 3</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有条件，则自动添加where</span>\r\n<span style=\"color: #008080;\"> 4</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\"> 5</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\"> 6</span> \r\n<span style=\"color: #008080;\"> 7</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 合成sql语句</span>\r\n<span style=\"color: #008080;\"> 8</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">select %(column_name_list)s from %(table_name)s %(wheres)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\"> 9</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name_list</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__column_name_list</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\">10</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">11</span> \r\n<span style=\"color: #008080;\">12</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model(self, wheres):\r\n</span><span style=\"color: #008080;\">13</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过条件获取一条记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">14</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">15</span>         sql =<span style=\"color: #000000;\"> self.get_model_sql(wheres)\r\n</span><span style=\"color: #008080;\">16</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初化化数据库链接</span>\r\n<span style=\"color: #008080;\">17</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">18</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">19</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0]\r\n</span><span style=\"color: #008080;\">20</span>         <span style=\"color: #0000ff;\">return</span> {}</pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>　　其他代码不一一细述，大家自己看看重构后的结果</p>\r\n<div class=\"cnblogs_code\" onclick=\"cnblogs_code_show(\'83efa635-3309-4b06-b5d5-5fd405316b69\')\"><img id=\"code_img_closed_83efa635-3309-4b06-b5d5-5fd405316b69\" class=\"code_img_closed\" src=\"https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif\" alt=\"\"><img id=\"code_img_opened_83efa635-3309-4b06-b5d5-5fd405316b69\" class=\"code_img_opened\" style=\"display: none;\" onclick=\"cnblogs_code_hide(\'83efa635-3309-4b06-b5d5-5fd405316b69\',event)\" src=\"https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif\" alt=\"\">\r\n<div id=\"cnblogs_code_open_83efa635-3309-4b06-b5d5-5fd405316b69\" class=\"cnblogs_code_hide\">\r\n<pre><span style=\"color: #008080;\">  1</span> <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">!/usr/bin/env python</span>\r\n<span style=\"color: #008080;\">  2</span> <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> coding=utf-8</span>\r\n<span style=\"color: #008080;\">  3</span> \r\n<span style=\"color: #008080;\">  4</span> <span style=\"color: #0000ff;\">from</span> common <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> db_helper, cache_helper, encrypt_helper\r\n</span><span style=\"color: #008080;\">  5</span> \r\n<span style=\"color: #008080;\">  6</span> \r\n<span style=\"color: #008080;\">  7</span> <span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> LogicBase():\r\n</span><span style=\"color: #008080;\">  8</span>     <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">逻辑层基础类</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">  9</span> \r\n<span style=\"color: #008080;\"> 10</span>     <span style=\"color: #0000ff;\">def</span> <span style=\"color: #800080;\">__init__</span>(self, db, is_output_sql, table_name, column_name_list=<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">*</span><span style=\"color: #800000;\">\'</span>, pk_name=<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\"> 11</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">类初始化</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 12</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 数据库参数</span>\r\n<span style=\"color: #008080;\"> 13</span>         self.<span style=\"color: #800080;\">__db</span> =<span style=\"color: #000000;\"> db\r\n</span><span style=\"color: #008080;\"> 14</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 是否输出执行的Sql语句到日志中</span>\r\n<span style=\"color: #008080;\"> 15</span>         self.<span style=\"color: #800080;\">__is_output_sql</span> =<span style=\"color: #000000;\"> is_output_sql\r\n</span><span style=\"color: #008080;\"> 16</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 表名称</span>\r\n<span style=\"color: #008080;\"> 17</span>         self.<span style=\"color: #800080;\">__table_name</span> =<span style=\"color: #000000;\"> str(table_name).lower()\r\n</span><span style=\"color: #008080;\"> 18</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 查询的列字段名称，*表示查询全部字段，多于1个字段时用逗号进行分隔，除了字段名外，也可以是表达式</span>\r\n<span style=\"color: #008080;\"> 19</span>         self.<span style=\"color: #800080;\">__column_name_list</span> =<span style=\"color: #000000;\"> str(column_name_list).lower()\r\n</span><span style=\"color: #008080;\"> 20</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 主健名称</span>\r\n<span style=\"color: #008080;\"> 21</span>         self.<span style=\"color: #800080;\">__pk_name</span> =<span style=\"color: #000000;\"> str(pk_name).lower()\r\n</span><span style=\"color: #008080;\"> 22</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 缓存列表</span>\r\n<span style=\"color: #008080;\"> 23</span>         self.<span style=\"color: #800080;\">__cache_list</span> = self.<span style=\"color: #800080;\">__table_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">_cache_list</span><span style=\"color: #800000;\">\'</span>\r\n<span style=\"color: #008080;\"> 24</span> \r\n<span style=\"color: #008080;\"> 25</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span>\r\n<span style=\"color: #008080;\"> 26</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 生成Sql ###</span>\r\n<span style=\"color: #008080;\"> 27</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model_sql(self, wheres):\r\n</span><span style=\"color: #008080;\"> 28</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过条件获取一条记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 29</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有条件，则自动添加where</span>\r\n<span style=\"color: #008080;\"> 30</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\"> 31</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\"> 32</span> \r\n<span style=\"color: #008080;\"> 33</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 合成sql语句</span>\r\n<span style=\"color: #008080;\"> 34</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">select %(column_name_list)s from %(table_name)s %(wheres)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\"> 35</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name_list</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__column_name_list</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\"> 36</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\"> 37</span> \r\n<span style=\"color: #008080;\"> 38</span>     <span style=\"color: #0000ff;\">def</span> get_model_for_pk_sql(self, pk, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\"> 39</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过主键值获取数据库记录实体</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 40</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 组装查询条件</span>\r\n<span style=\"color: #008080;\"> 41</span>         wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">%s = %s</span><span style=\"color: #800000;\">\'</span> % (self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">, str(pk))\r\n</span><span style=\"color: #008080;\"> 42</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> self.get_model_sql(wheres)\r\n</span><span style=\"color: #008080;\"> 43</span> \r\n<span style=\"color: #008080;\"> 44</span>     <span style=\"color: #0000ff;\">def</span> get_value_sql(self, column_name, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\"> 45</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 46</span> <span style=\"color: #800000;\">        获取指定条件的字段值————多于条记录时，只取第一条记录\r\n</span><span style=\"color: #008080;\"> 47</span> <span style=\"color: #800000;\">        :param column_name: 单个字段名，如：id\r\n</span><span style=\"color: #008080;\"> 48</span> <span style=\"color: #800000;\">        :param wheres: 查询条件\r\n</span><span style=\"color: #008080;\"> 49</span> <span style=\"color: #800000;\">        :return: 7 （指定的字段值）\r\n</span><span style=\"color: #008080;\"> 50</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 51</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\"> 52</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\"> 53</span> \r\n<span style=\"color: #008080;\"> 54</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select %(column_name)s from %(table_name)s %(wheres)s limit 1</span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\"> 55</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name</span><span style=\"color: #800000;\">\'</span>: column_name, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\"> 56</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\"> 57</span> \r\n<span style=\"color: #008080;\"> 58</span>     <span style=\"color: #0000ff;\">def</span> get_value_list_sql(self, column_name, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\"> 59</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 60</span> <span style=\"color: #800000;\">        获取指定条件记录的字段值列表\r\n</span><span style=\"color: #008080;\"> 61</span> <span style=\"color: #800000;\">        :param column_name: 单个字段名，如：id\r\n</span><span style=\"color: #008080;\"> 62</span> <span style=\"color: #800000;\">        :param wheres: 查询条件\r\n</span><span style=\"color: #008080;\"> 63</span> <span style=\"color: #800000;\">        :return: [1,3,4,6,7]\r\n</span><span style=\"color: #008080;\"> 64</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 65</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> column_name:\r\n</span><span style=\"color: #008080;\"> 66</span>             column_name = self.<span style=\"color: #800080;\">__pk_name</span>\r\n<span style=\"color: #008080;\"> 67</span>         <span style=\"color: #0000ff;\">elif</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\"> 68</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\"> 69</span> \r\n<span style=\"color: #008080;\"> 70</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select array_agg(%(column_name)s) as list from %(table_name)s %(wheres)s</span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\"> 71</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name</span><span style=\"color: #800000;\">\'</span>: column_name, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\"> 72</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\"> 73</span> \r\n<span style=\"color: #008080;\"> 74</span>     <span style=\"color: #0000ff;\">def</span> add_model_sql(self, fields, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\"> 75</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">新增数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\"> 76</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 拼接sql语句 ###</span>\r\n<span style=\"color: #008080;\"> 77</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化变量</span>\r\n<span style=\"color: #008080;\"> 78</span>         key_list =<span style=\"color: #000000;\"> []\r\n</span><span style=\"color: #008080;\"> 79</span>         value_list =<span style=\"color: #000000;\"> []\r\n</span><span style=\"color: #008080;\"> 80</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 将传入的字典参数进行处理，把字段名生成sql插入字段名数组和字典替换数组</span>\r\n<span style=\"color: #008080;\"> 81</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> PS:字符串使用字典替换参数时，格式是%(name)s，这里会生成对应的字串</span>\r\n<span style=\"color: #008080;\"> 82</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 比如：</span>\r\n<span style=\"color: #008080;\"> 83</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">   传入的字典为： {\'id\': 1, \'name\': \'名称\'}</span>\r\n<span style=\"color: #008080;\"> 84</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">   那么生成的key_list为：\'id\',\'name\'</span>\r\n<span style=\"color: #008080;\"> 85</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">   而value_list为：\'%(id)s,%(name)s\'</span>\r\n<span style=\"color: #008080;\"> 86</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">   最终而value_list为字符串对应名称位置会被替换成相应的值</span>\r\n<span style=\"color: #008080;\"> 87</span>         <span style=\"color: #0000ff;\">for</span> key <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> fields.keys():\r\n</span><span style=\"color: #008080;\"> 88</span> <span style=\"color: #000000;\">            key_list.append(key)\r\n</span><span style=\"color: #008080;\"> 89</span>             value_list.append(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">%(</span><span style=\"color: #800000;\">\'</span> + key + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">)s</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\"> 90</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 设置sql拼接字典，并将数组（lit）使用join方式进行拼接，生成用逗号分隔的字符串</span>\r\n<span style=\"color: #008080;\"> 91</span>         parameter =<span style=\"color: #000000;\"> {\r\n</span><span style=\"color: #008080;\"> 92</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span><span style=\"color: #000000;\">,\r\n</span><span style=\"color: #008080;\"> 93</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">pk_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">,\r\n</span><span style=\"color: #008080;\"> 94</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">key_list</span><span style=\"color: #800000;\">\'</span>: <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">,</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">.join(key_list),\r\n</span><span style=\"color: #008080;\"> 95</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">value_list</span><span style=\"color: #800000;\">\'</span>: <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">,</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">.join(value_list)\r\n</span><span style=\"color: #008080;\"> 96</span> <span style=\"color: #000000;\">        }\r\n</span><span style=\"color: #008080;\"> 97</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有指定返回参数，则添加</span>\r\n<span style=\"color: #008080;\"> 98</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> returning:\r\n</span><span style=\"color: #008080;\"> 99</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">returning</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">, </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> returning\r\n</span><span style=\"color: #008080;\">100</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">101</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">returning</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'\'</span>\r\n<span style=\"color: #008080;\">102</span> \r\n<span style=\"color: #008080;\">103</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成可以使用字典替换的字符串</span>\r\n<span style=\"color: #008080;\">104</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">insert into %(table_name)s (%(key_list)s) values (%(value_list)s) returning %(pk_name)s %(returning)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> parameter\r\n</span><span style=\"color: #008080;\">105</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 将生成好的字符串替字典参数值，生成最终可执行的sql语句</span>\r\n<span style=\"color: #008080;\">106</span>         <span style=\"color: #0000ff;\">return</span> sql %<span style=\"color: #000000;\"> fields\r\n</span><span style=\"color: #008080;\">107</span> \r\n<span style=\"color: #008080;\">108</span>     <span style=\"color: #0000ff;\">def</span> edit_sql(self, fields, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">109</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">110</span> <span style=\"color: #800000;\">        批量编辑数据库记录\r\n</span><span style=\"color: #008080;\">111</span> <span style=\"color: #800000;\">        :param fields: 要更新的字段（字段名与值存储在字典中）\r\n</span><span style=\"color: #008080;\">112</span> <span style=\"color: #800000;\">        :param wheres: 更新条件\r\n</span><span style=\"color: #008080;\">113</span> <span style=\"color: #800000;\">        :param returning: 更新成功后，返回的字段名\r\n</span><span style=\"color: #008080;\">114</span> <span style=\"color: #800000;\">        :param is_update_cache: 是否同步更新缓存\r\n</span><span style=\"color: #008080;\">115</span> <span style=\"color: #800000;\">        :return:\r\n</span><span style=\"color: #008080;\">116</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">117</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 拼接sql语句 ###</span>\r\n<span style=\"color: #008080;\">118</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 拼接字段与值</span>\r\n<span style=\"color: #008080;\">119</span>         field_list = [key + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> = %(</span><span style=\"color: #800000;\">\'</span> + key + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">)s</span><span style=\"color: #800000;\">\'</span> <span style=\"color: #0000ff;\">for</span> key <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> fields.keys()]\r\n</span><span style=\"color: #008080;\">120</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 设置sql拼接字典</span>\r\n<span style=\"color: #008080;\">121</span>         parameter =<span style=\"color: #000000;\"> {\r\n</span><span style=\"color: #008080;\">122</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span><span style=\"color: #000000;\">,\r\n</span><span style=\"color: #008080;\">123</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">pk_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">,\r\n</span><span style=\"color: #008080;\">124</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">field_list</span><span style=\"color: #800000;\">\'</span>: <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">,</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">.join(field_list)\r\n</span><span style=\"color: #008080;\">125</span> <span style=\"color: #000000;\">        }\r\n</span><span style=\"color: #008080;\">126</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果存在更新条件，则将条件添加到sql拼接更换字典中</span>\r\n<span style=\"color: #008080;\">127</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">128</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">129</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">130</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'\'</span>\r\n<span style=\"color: #008080;\">131</span> \r\n<span style=\"color: #008080;\">132</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有指定返回参数，则添加</span>\r\n<span style=\"color: #008080;\">133</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> returning:\r\n</span><span style=\"color: #008080;\">134</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">returning</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">, </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> returning\r\n</span><span style=\"color: #008080;\">135</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">136</span>             parameter[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">returning</span><span style=\"color: #800000;\">\'</span>] = <span style=\"color: #800000;\">\'\'</span>\r\n<span style=\"color: #008080;\">137</span> \r\n<span style=\"color: #008080;\">138</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql语句</span>\r\n<span style=\"color: #008080;\">139</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">update %(table_name)s set %(field_list)s %(wheres)s returning %(pk_name)s %(returning)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> parameter\r\n</span><span style=\"color: #008080;\">140</span>         <span style=\"color: #0000ff;\">return</span> sql %<span style=\"color: #000000;\"> fields\r\n</span><span style=\"color: #008080;\">141</span> \r\n<span style=\"color: #008080;\">142</span>     <span style=\"color: #0000ff;\">def</span> edit_model_sql(self, pk, fields, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">143</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">编辑单条数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">144</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">145</span>             wheres = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> = </span><span style=\"color: #800000;\">\'</span> + str(pk) + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> and </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">146</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">147</span>             wheres = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> = </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> str(pk)\r\n</span><span style=\"color: #008080;\">148</span> \r\n<span style=\"color: #008080;\">149</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> self.edit_sql(fields, wheres, returning)\r\n</span><span style=\"color: #008080;\">150</span> \r\n<span style=\"color: #008080;\">151</span>     <span style=\"color: #0000ff;\">def</span> delete_sql(self, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">152</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">153</span> <span style=\"color: #800000;\">        批量删除数据库记录\r\n</span><span style=\"color: #008080;\">154</span> <span style=\"color: #800000;\">        :param wheres: 删除条件\r\n</span><span style=\"color: #008080;\">155</span> <span style=\"color: #800000;\">        :param returning: 删除成功后，返回的字段名\r\n</span><span style=\"color: #008080;\">156</span> <span style=\"color: #800000;\">        :param is_update_cache: 是否同步更新缓存\r\n</span><span style=\"color: #008080;\">157</span> <span style=\"color: #800000;\">        :return:\r\n</span><span style=\"color: #008080;\">158</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">159</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果存在条件</span>\r\n<span style=\"color: #008080;\">160</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">161</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">162</span> \r\n<span style=\"color: #008080;\">163</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果有指定返回参数，则添加</span>\r\n<span style=\"color: #008080;\">164</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> returning:\r\n</span><span style=\"color: #008080;\">165</span>             returning = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">, </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> returning\r\n</span><span style=\"color: #008080;\">166</span> \r\n<span style=\"color: #008080;\">167</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql语句</span>\r\n<span style=\"color: #008080;\">168</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">delete from %(table_name)s %(wheres)s returning %(pk_name)s %(returning)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">169</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>: wheres, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">pk_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__pk_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">returning</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: returning}\r\n</span><span style=\"color: #008080;\">170</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">171</span> \r\n<span style=\"color: #008080;\">172</span>     <span style=\"color: #0000ff;\">def</span> delete_model_sql(self, pk, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">173</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">删除单条数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">174</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">175</span>             wheres = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> = </span><span style=\"color: #800000;\">\'</span> + str(pk) + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> and </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">176</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">177</span>             wheres = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> = </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> str(pk)\r\n</span><span style=\"color: #008080;\">178</span> \r\n<span style=\"color: #008080;\">179</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> self.delete_sql(wheres, returning)\r\n</span><span style=\"color: #008080;\">180</span> \r\n<span style=\"color: #008080;\">181</span>     <span style=\"color: #0000ff;\">def</span> get_list_sql(self, column_name_list=<span style=\"color: #800000;\">\'\'</span>, wheres=<span style=\"color: #800000;\">\'\'</span>, orderby=None, table_name=<span style=\"color: #000000;\">None):\r\n</span><span style=\"color: #008080;\">182</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">183</span> <span style=\"color: #800000;\">        获取指定条件的数据库记录集\r\n</span><span style=\"color: #008080;\">184</span> <span style=\"color: #800000;\">        :param column_name_list:      查询字段\r\n</span><span style=\"color: #008080;\">185</span> <span style=\"color: #800000;\">        :param wheres:      查询条件\r\n</span><span style=\"color: #008080;\">186</span> <span style=\"color: #800000;\">        :param orderby:     排序规则\r\n</span><span style=\"color: #008080;\">187</span> <span style=\"color: #800000;\">        :param table_name:     查询数据表，多表查询时需要设置\r\n</span><span style=\"color: #008080;\">188</span> <span style=\"color: #800000;\">        :return:\r\n</span><span style=\"color: #008080;\">189</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">190</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询数据表名称</span>\r\n<span style=\"color: #008080;\">191</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> table_name:\r\n</span><span style=\"color: #008080;\">192</span>             table_name = self.<span style=\"color: #800080;\">__table_name</span>\r\n<span style=\"color: #008080;\">193</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询字段名</span>\r\n<span style=\"color: #008080;\">194</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> column_name_list:\r\n</span><span style=\"color: #008080;\">195</span>             column_name_list = self.<span style=\"color: #800080;\">__column_name_list</span>\r\n<span style=\"color: #008080;\">196</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询条件</span>\r\n<span style=\"color: #008080;\">197</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">198</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果是字符串，表示该查询条件已组装好了，直接可以使用</span>\r\n<span style=\"color: #008080;\">199</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> isinstance(wheres, str):\r\n</span><span style=\"color: #008080;\">200</span>                 wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">201</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果是list，则表示查询条件有多个，可以使用join将它们用and方式组合起来使用</span>\r\n<span style=\"color: #008080;\">202</span>             <span style=\"color: #0000ff;\">elif</span><span style=\"color: #000000;\"> isinstance(wheres, list):\r\n</span><span style=\"color: #008080;\">203</span>                 wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">where </span><span style=\"color: #800000;\">\'</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> and </span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">.join(wheres)\r\n</span><span style=\"color: #008080;\">204</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化排序</span>\r\n<span style=\"color: #008080;\">205</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> orderby:\r\n</span><span style=\"color: #008080;\">206</span>             orderby = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> desc</span><span style=\"color: #800000;\">\'</span>\r\n<span style=\"color: #008080;\">207</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">############################################################</span>\r\n<span style=\"color: #008080;\">208</span> \r\n<span style=\"color: #008080;\">209</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 按条件查询数据库记录</span>\r\n<span style=\"color: #008080;\">210</span>         sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">select %(column_name_list)s from %(table_name)s %(wheres)s order by %(orderby)s </span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">211</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name_list</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: column_name_list,\r\n</span><span style=\"color: #008080;\">212</span>                <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: table_name,\r\n</span><span style=\"color: #008080;\">213</span>                <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres,\r\n</span><span style=\"color: #008080;\">214</span>                <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">orderby</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: orderby}\r\n</span><span style=\"color: #008080;\">215</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">216</span> \r\n<span style=\"color: #008080;\">217</span>     <span style=\"color: #0000ff;\">def</span> get_count_sql(self, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">218</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取指定条件记录数量</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">219</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">220</span>             wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">221</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select count(1) as total from %(table_name)s %(wheres)s </span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">222</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\">223</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">224</span> \r\n<span style=\"color: #008080;\">225</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_sum_sql(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">226</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取指定条件记录数量</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">227</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select sum(%(fields)s) as total from %(table_name)s where %(wheres)s </span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">228</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>: wheres, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">fields</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: fields}\r\n</span><span style=\"color: #008080;\">229</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">230</span> \r\n<span style=\"color: #008080;\">231</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_min_sql(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">232</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取该列记录最小值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">233</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select min(%(fields)s) as min from %(table_name)s where %(wheres)s </span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">234</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>: wheres, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">fields</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: fields}\r\n</span><span style=\"color: #008080;\">235</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">236</span> \r\n<span style=\"color: #008080;\">237</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_max_sql(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">238</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取该列记录最大值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">239</span>         sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select max(%(fields)s) as max from %(table_name)s where %(wheres)s </span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">240</span>               {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span>: wheres, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">fields</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: fields}\r\n</span><span style=\"color: #008080;\">241</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> sql\r\n</span><span style=\"color: #008080;\">242</span> \r\n<span style=\"color: #008080;\">243</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span>\r\n<span style=\"color: #008080;\">244</span> \r\n<span style=\"color: #008080;\">245</span> \r\n<span style=\"color: #008080;\">246</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span>\r\n<span style=\"color: #008080;\">247</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 执行Sql ###</span>\r\n<span style=\"color: #008080;\">248</span> \r\n<span style=\"color: #008080;\">249</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> select(self, sql):\r\n</span><span style=\"color: #008080;\">250</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">执行sql查询语句（select）</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">251</span>         with db_helper.PgHelper(self.<span style=\"color: #800080;\">__db</span>, self.<span style=\"color: #800080;\">__is_output_sql</span><span style=\"color: #000000;\">) as db:\r\n</span><span style=\"color: #008080;\">252</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">253</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">254</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">255</span>                 result =<span style=\"color: #000000;\"> []\r\n</span><span style=\"color: #008080;\">256</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">257</span> \r\n<span style=\"color: #008080;\">258</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> execute(self, sql):\r\n</span><span style=\"color: #008080;\">259</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">执行sql语句，并提交事务</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">260</span>         with db_helper.PgHelper(self.<span style=\"color: #800080;\">__db</span>, self.<span style=\"color: #800080;\">__is_output_sql</span><span style=\"color: #000000;\">) as db:\r\n</span><span style=\"color: #008080;\">261</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">262</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">263</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">264</span> <span style=\"color: #000000;\">                db.commit()\r\n</span><span style=\"color: #008080;\">265</span>             <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">266</span>                 result =<span style=\"color: #000000;\"> []\r\n</span><span style=\"color: #008080;\">267</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">268</span> \r\n<span style=\"color: #008080;\">269</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> copy(self, values, columns):\r\n</span><span style=\"color: #008080;\">270</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">批量更新数据</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">271</span>         with db_helper.PgHelper(self.<span style=\"color: #800080;\">__db</span>, self.<span style=\"color: #800080;\">__is_output_sql</span><span style=\"color: #000000;\">) as db:\r\n</span><span style=\"color: #008080;\">272</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">273</span>             result = db.copy(values, self.<span style=\"color: #800080;\">__table_name</span><span style=\"color: #000000;\">, columns)\r\n</span><span style=\"color: #008080;\">274</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">275</span> \r\n<span style=\"color: #008080;\">276</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model(self, wheres):\r\n</span><span style=\"color: #008080;\">277</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过条件获取一条记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">278</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">279</span>         sql =<span style=\"color: #000000;\"> self.get_model_sql(wheres)\r\n</span><span style=\"color: #008080;\">280</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行查询操作</span>\r\n<span style=\"color: #008080;\">281</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">282</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">283</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0]\r\n</span><span style=\"color: #008080;\">284</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">285</span> \r\n<span style=\"color: #008080;\">286</span>     <span style=\"color: #0000ff;\">def</span> get_model_for_pk(self, pk, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">287</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">通过主键值获取数据库记录实体</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">288</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> pk:\r\n</span><span style=\"color: #008080;\">289</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">290</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">291</span>         sql =<span style=\"color: #000000;\"> self.get_model_for_pk_sql(pk, wheres)\r\n</span><span style=\"color: #008080;\">292</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行查询操作</span>\r\n<span style=\"color: #008080;\">293</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">294</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">295</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0]\r\n</span><span style=\"color: #008080;\">296</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">297</span> \r\n<span style=\"color: #008080;\">298</span>     <span style=\"color: #0000ff;\">def</span> get_value(self, column_name, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">299</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">300</span> <span style=\"color: #800000;\">        获取指定条件的字段值————多于条记录时，只取第一条记录\r\n</span><span style=\"color: #008080;\">301</span> <span style=\"color: #800000;\">        :param column_name: 单个字段名，如：id\r\n</span><span style=\"color: #008080;\">302</span> <span style=\"color: #800000;\">        :param wheres: 查询条件\r\n</span><span style=\"color: #008080;\">303</span> <span style=\"color: #800000;\">        :return: 7 （指定的字段值）\r\n</span><span style=\"color: #008080;\">304</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">305</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> column_name:\r\n</span><span style=\"color: #008080;\">306</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> None\r\n</span><span style=\"color: #008080;\">307</span> \r\n<span style=\"color: #008080;\">308</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">309</span>         sql =<span style=\"color: #000000;\"> self.get_value_sql(column_name, wheres)\r\n</span><span style=\"color: #008080;\">310</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">311</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询成功，则直接返回记录字典</span>\r\n<span style=\"color: #008080;\">312</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">313</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0].get(column_name)\r\n</span><span style=\"color: #008080;\">314</span> \r\n<span style=\"color: #008080;\">315</span>     <span style=\"color: #0000ff;\">def</span> get_value_list(self, column_name, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">316</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">317</span> <span style=\"color: #800000;\">        获取指定条件记录的字段值列表\r\n</span><span style=\"color: #008080;\">318</span> <span style=\"color: #800000;\">        :param column_name: 单个字段名，如：id\r\n</span><span style=\"color: #008080;\">319</span> <span style=\"color: #800000;\">        :param wheres: 查询条件\r\n</span><span style=\"color: #008080;\">320</span> <span style=\"color: #800000;\">        :return: [1,3,4,6,7]\r\n</span><span style=\"color: #008080;\">321</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">322</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">323</span>         sql =<span style=\"color: #000000;\"> self.get_value_list_sql(column_name, wheres)\r\n</span><span style=\"color: #008080;\">324</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">325</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询失败或不存在指定条件记录，则直接返回初始值</span>\r\n<span style=\"color: #008080;\">326</span>         <span style=\"color: #0000ff;\">if</span> result <span style=\"color: #0000ff;\">and</span><span style=\"color: #000000;\"> isinstance(result, list):\r\n</span><span style=\"color: #008080;\">327</span>             <span style=\"color: #0000ff;\">return</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">list</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">328</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">329</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> []\r\n</span><span style=\"color: #008080;\">330</span> \r\n<span style=\"color: #008080;\">331</span>     <span style=\"color: #0000ff;\">def</span> add_model(self, fields, returning=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">332</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">新增数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">333</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">334</span>         sql =<span style=\"color: #000000;\"> self.add_model_sql(fields, returning)\r\n</span><span style=\"color: #008080;\">335</span>         result =<span style=\"color: #000000;\"> self.execute(sql)\r\n</span><span style=\"color: #008080;\">336</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">337</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result[0]\r\n</span><span style=\"color: #008080;\">338</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">339</span> \r\n<span style=\"color: #008080;\">340</span>     <span style=\"color: #0000ff;\">def</span> edit(self, fields, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span>, is_update_cache=<span style=\"color: #000000;\">True):\r\n</span><span style=\"color: #008080;\">341</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">342</span> <span style=\"color: #800000;\">        批量编辑数据库记录\r\n</span><span style=\"color: #008080;\">343</span> <span style=\"color: #800000;\">        :param fields: 要更新的字段（字段名与值存储在字典中）\r\n</span><span style=\"color: #008080;\">344</span> <span style=\"color: #800000;\">        :param wheres: 更新条件\r\n</span><span style=\"color: #008080;\">345</span> <span style=\"color: #800000;\">        :param returning: 更新成功后，返回的字段名\r\n</span><span style=\"color: #008080;\">346</span> <span style=\"color: #800000;\">        :param is_update_cache: 是否同步更新缓存\r\n</span><span style=\"color: #008080;\">347</span> <span style=\"color: #800000;\">        :return:\r\n</span><span style=\"color: #008080;\">348</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">349</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">350</span>         sql =<span style=\"color: #000000;\"> self.edit_sql(fields, wheres, returning)\r\n</span><span style=\"color: #008080;\">351</span>         result =<span style=\"color: #000000;\"> self.execute(sql)\r\n</span><span style=\"color: #008080;\">352</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">353</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断是否删除对应的缓存</span>\r\n<span style=\"color: #008080;\">354</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> is_update_cache:\r\n</span><span style=\"color: #008080;\">355</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 循环删除更新成功的所有记录对应的缓存</span>\r\n<span style=\"color: #008080;\">356</span>                 <span style=\"color: #0000ff;\">for</span> model <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">357</span>                     self.del_model_for_cache(model.get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">, 0))\r\n</span><span style=\"color: #008080;\">358</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除与本表关联的缓存</span>\r\n<span style=\"color: #008080;\">359</span> <span style=\"color: #000000;\">                self.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">360</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">361</span> \r\n<span style=\"color: #008080;\">362</span>     <span style=\"color: #0000ff;\">def</span> edit_model(self, pk, fields, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span>, is_update_cache=<span style=\"color: #000000;\">True):\r\n</span><span style=\"color: #008080;\">363</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">编辑单条数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">364</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> pk:\r\n</span><span style=\"color: #008080;\">365</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">366</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">367</span>         sql =<span style=\"color: #000000;\"> self.edit_model_sql(pk, fields, wheres, returning)\r\n</span><span style=\"color: #008080;\">368</span>         result =<span style=\"color: #000000;\"> self.execute(sql)\r\n</span><span style=\"color: #008080;\">369</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">370</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断是否删除对应的缓存</span>\r\n<span style=\"color: #008080;\">371</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> is_update_cache:\r\n</span><span style=\"color: #008080;\">372</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 删除更新成功的所有记录对应的缓存</span>\r\n<span style=\"color: #008080;\">373</span>                 self.del_model_for_cache(result[0].get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">, 0))\r\n</span><span style=\"color: #008080;\">374</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除与本表关联的缓存</span>\r\n<span style=\"color: #008080;\">375</span> <span style=\"color: #000000;\">                self.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">376</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">377</span> \r\n<span style=\"color: #008080;\">378</span>     <span style=\"color: #0000ff;\">def</span> delete(self, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span>, is_update_cache=<span style=\"color: #000000;\">True):\r\n</span><span style=\"color: #008080;\">379</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">380</span> <span style=\"color: #800000;\">        批量删除数据库记录\r\n</span><span style=\"color: #008080;\">381</span> <span style=\"color: #800000;\">        :param wheres: 删除条件\r\n</span><span style=\"color: #008080;\">382</span> <span style=\"color: #800000;\">        :param returning: 删除成功后，返回的字段名\r\n</span><span style=\"color: #008080;\">383</span> <span style=\"color: #800000;\">        :param is_update_cache: 是否同步更新缓存\r\n</span><span style=\"color: #008080;\">384</span> <span style=\"color: #800000;\">        :return:\r\n</span><span style=\"color: #008080;\">385</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">386</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">387</span>         sql =<span style=\"color: #000000;\"> self.delete_sql(wheres, returning)\r\n</span><span style=\"color: #008080;\">388</span>         result =<span style=\"color: #000000;\"> self.execute(sql)\r\n</span><span style=\"color: #008080;\">389</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">390</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除对应的缓存</span>\r\n<span style=\"color: #008080;\">391</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> is_update_cache:\r\n</span><span style=\"color: #008080;\">392</span>                 <span style=\"color: #0000ff;\">for</span> model <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">393</span>                     self.del_model_for_cache(model.get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">, 0))\r\n</span><span style=\"color: #008080;\">394</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除与本表关联的缓存</span>\r\n<span style=\"color: #008080;\">395</span> <span style=\"color: #000000;\">                self.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">396</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">397</span> \r\n<span style=\"color: #008080;\">398</span>     <span style=\"color: #0000ff;\">def</span> delete_model(self, pk, wheres=<span style=\"color: #800000;\">\'\'</span>, returning=<span style=\"color: #800000;\">\'\'</span>, is_update_cache=<span style=\"color: #000000;\">True):\r\n</span><span style=\"color: #008080;\">399</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">删除单条数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">400</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> pk:\r\n</span><span style=\"color: #008080;\">401</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">402</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">403</span>         sql =<span style=\"color: #000000;\"> self.delete_model_sql(pk, wheres, returning)\r\n</span><span style=\"color: #008080;\">404</span>         result =<span style=\"color: #000000;\"> self.execute(sql)\r\n</span><span style=\"color: #008080;\">405</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">406</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除对应的缓存</span>\r\n<span style=\"color: #008080;\">407</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> is_update_cache:\r\n</span><span style=\"color: #008080;\">408</span>                 self.del_model_for_cache(result[0].get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">, 0))\r\n</span><span style=\"color: #008080;\">409</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步删除与本表关联的缓存</span>\r\n<span style=\"color: #008080;\">410</span> <span style=\"color: #000000;\">                self.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">411</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">412</span> \r\n<span style=\"color: #008080;\">413</span>     <span style=\"color: #0000ff;\">def</span> get_list(self, column_name_list=<span style=\"color: #800000;\">\'\'</span>, wheres=<span style=\"color: #800000;\">\'\'</span>, page_number=None, page_size=None, orderby=None, table_name=<span style=\"color: #000000;\">None):\r\n</span><span style=\"color: #008080;\">414</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">415</span> <span style=\"color: #800000;\">        获取指定条件的数据库记录集\r\n</span><span style=\"color: #008080;\">416</span> <span style=\"color: #800000;\">        :param column_name_list:      查询字段\r\n</span><span style=\"color: #008080;\">417</span> <span style=\"color: #800000;\">        :param wheres:      查询条件\r\n</span><span style=\"color: #008080;\">418</span> <span style=\"color: #800000;\">        :param page_number:   分页索引值\r\n</span><span style=\"color: #008080;\">419</span> <span style=\"color: #800000;\">        :param page_size:    分页大小， 存在值时才会执行分页\r\n</span><span style=\"color: #008080;\">420</span> <span style=\"color: #800000;\">        :param orderby:     排序规则\r\n</span><span style=\"color: #008080;\">421</span> <span style=\"color: #800000;\">        :param table_name:     查询数据表，多表查询时需要设置\r\n</span><span style=\"color: #008080;\">422</span> <span style=\"color: #800000;\">        :return: 返回记录集总数量与分页记录集\r\n</span><span style=\"color: #008080;\">423</span> <span style=\"color: #800000;\">            {\'records\': 0, \'total\': 0, \'page\': 0, \'rows\': []}\r\n</span><span style=\"color: #008080;\">424</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">425</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化输出参数：总记录数量与列表集</span>\r\n<span style=\"color: #008080;\">426</span>         data =<span style=\"color: #000000;\"> {\r\n</span><span style=\"color: #008080;\">427</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>: 0,  <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 总记录数</span>\r\n<span style=\"color: #008080;\">428</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">total</span><span style=\"color: #800000;\">\'</span>: 0,  <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 总页数</span>\r\n<span style=\"color: #008080;\">429</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">page</span><span style=\"color: #800000;\">\'</span>: 1,  <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 当前页面索引</span>\r\n<span style=\"color: #008080;\">430</span>             <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">rows</span><span style=\"color: #800000;\">\'</span>: [],  <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 查询结果（记录列表）</span>\r\n<span style=\"color: #008080;\">431</span> <span style=\"color: #000000;\">        }\r\n</span><span style=\"color: #008080;\">432</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询数据表名称</span>\r\n<span style=\"color: #008080;\">433</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> table_name:\r\n</span><span style=\"color: #008080;\">434</span>             table_name = self.<span style=\"color: #800080;\">__table_name</span>\r\n<span style=\"color: #008080;\">435</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询字段名</span>\r\n<span style=\"color: #008080;\">436</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> column_name_list:\r\n</span><span style=\"color: #008080;\">437</span>             column_name_list = self.<span style=\"color: #800080;\">__column_name_list</span>\r\n<span style=\"color: #008080;\">438</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化查询条件</span>\r\n<span style=\"color: #008080;\">439</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> wheres:\r\n</span><span style=\"color: #008080;\">440</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果是字符串，表示该查询条件已组装好了，直接可以使用</span>\r\n<span style=\"color: #008080;\">441</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> isinstance(wheres, str):\r\n</span><span style=\"color: #008080;\">442</span>                 wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">where </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> wheres\r\n</span><span style=\"color: #008080;\">443</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果是list，则表示查询条件有多个，可以使用join将它们用and方式组合起来使用</span>\r\n<span style=\"color: #008080;\">444</span>             <span style=\"color: #0000ff;\">elif</span><span style=\"color: #000000;\"> isinstance(wheres, list):\r\n</span><span style=\"color: #008080;\">445</span>                 wheres = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">where </span><span style=\"color: #800000;\">\'</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> and </span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">.join(wheres)\r\n</span><span style=\"color: #008080;\">446</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化排序</span>\r\n<span style=\"color: #008080;\">447</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> orderby:\r\n</span><span style=\"color: #008080;\">448</span>             orderby = self.<span style=\"color: #800080;\">__pk_name</span> + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> desc</span><span style=\"color: #800000;\">\'</span>\r\n<span style=\"color: #008080;\">449</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化分页查询的记录区间</span>\r\n<span style=\"color: #008080;\">450</span>         paging = <span style=\"color: #800000;\">\'\'</span>\r\n<span style=\"color: #008080;\">451</span> \r\n<span style=\"color: #008080;\">452</span>         with db_helper.PgHelper(self.<span style=\"color: #800080;\">__db</span>, self.<span style=\"color: #800080;\">__is_output_sql</span><span style=\"color: #000000;\">) as db:\r\n</span><span style=\"color: #008080;\">453</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">############################################################</span>\r\n<span style=\"color: #008080;\">454</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断是否需要进行分页</span>\r\n<span style=\"color: #008080;\">455</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span> page_size <span style=\"color: #0000ff;\">is</span><span style=\"color: #000000;\"> None:\r\n</span><span style=\"color: #008080;\">456</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 执行sql，获取指定条件的记录总数量</span>\r\n<span style=\"color: #008080;\">457</span>                 sql = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">select count(1) as records from %(table_name)s %(wheres)s </span><span style=\"color: #800000;\">\'</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">458</span>                       {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span>: table_name, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres}\r\n</span><span style=\"color: #008080;\">459</span>                 result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">460</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询失败或不存在指定条件记录，则直接返回初始值</span>\r\n<span style=\"color: #008080;\">461</span>                 <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span> result <span style=\"color: #0000ff;\">or</span> result[0][<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] ==<span style=\"color: #000000;\"> 0:\r\n</span><span style=\"color: #008080;\">462</span>                     <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> data\r\n</span><span style=\"color: #008080;\">463</span> \r\n<span style=\"color: #008080;\">464</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 设置记录总数量</span>\r\n<span style=\"color: #008080;\">465</span>                 data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] = result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">466</span> \r\n<span style=\"color: #008080;\">467</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">########################################################</span>\r\n<span style=\"color: #008080;\">468</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 设置分页索引与页面大小 ###</span>\r\n<span style=\"color: #008080;\">469</span>                 <span style=\"color: #0000ff;\">if</span> page_size &lt;=<span style=\"color: #000000;\"> 0:\r\n</span><span style=\"color: #008080;\">470</span>                     page_size = 10\r\n<span style=\"color: #008080;\">471</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 计算总分页数量：通过总记录数除于每页显示数量来计算总分页数量</span>\r\n<span style=\"color: #008080;\">472</span>                 <span style=\"color: #0000ff;\">if</span> data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] % page_size ==<span style=\"color: #000000;\"> 0:\r\n</span><span style=\"color: #008080;\">473</span>                     page_total = data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] //<span style=\"color: #000000;\"> page_size\r\n</span><span style=\"color: #008080;\">474</span>                 <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">475</span>                     page_total = data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] // page_size + 1\r\n<span style=\"color: #008080;\">476</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断页码是否超出限制，超出限制查询时会出现异常，所以将页面索引设置为最后一页</span>\r\n<span style=\"color: #008080;\">477</span>                 <span style=\"color: #0000ff;\">if</span> page_number &lt; 1 <span style=\"color: #0000ff;\">or</span> page_number &gt;<span style=\"color: #000000;\"> page_total:\r\n</span><span style=\"color: #008080;\">478</span>                     page_number =<span style=\"color: #000000;\"> page_total\r\n</span><span style=\"color: #008080;\">479</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 记录总页面数量</span>\r\n<span style=\"color: #008080;\">480</span>                 data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">total</span><span style=\"color: #800000;\">\'</span>] =<span style=\"color: #000000;\"> page_total\r\n</span><span style=\"color: #008080;\">481</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 记录当前页面值</span>\r\n<span style=\"color: #008080;\">482</span>                 data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">page</span><span style=\"color: #800000;\">\'</span>] =<span style=\"color: #000000;\"> page_number\r\n</span><span style=\"color: #008080;\">483</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 计算当前页面要显示的记录起始位置（limit指定的位置）</span>\r\n<span style=\"color: #008080;\">484</span>                 record_number = (page_number - 1) *<span style=\"color: #000000;\"> page_size\r\n</span><span style=\"color: #008080;\">485</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 设置查询分页条件</span>\r\n<span style=\"color: #008080;\">486</span>                 paging = <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> limit </span><span style=\"color: #800000;\">\'</span> + str(page_size) + <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\"> offset </span><span style=\"color: #800000;\">\'</span> +<span style=\"color: #000000;\"> str(record_number)\r\n</span><span style=\"color: #008080;\">487</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">############################################################</span>\r\n<span style=\"color: #008080;\">488</span> \r\n<span style=\"color: #008080;\">489</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 按条件查询数据库记录</span>\r\n<span style=\"color: #008080;\">490</span>             sql = <span style=\"color: #800000;\">\"</span><span style=\"color: #800000;\">select %(column_name_list)s from %(table_name)s %(wheres)s order by %(orderby)s %(paging)s</span><span style=\"color: #800000;\">\"</span> %<span style=\"color: #000000;\"> \\\r\n</span><span style=\"color: #008080;\">491</span>                   {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">column_name_list</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: column_name_list,\r\n</span><span style=\"color: #008080;\">492</span>                    <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">table_name</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: table_name,\r\n</span><span style=\"color: #008080;\">493</span>                    <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">wheres</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: wheres,\r\n</span><span style=\"color: #008080;\">494</span>                    <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">orderby</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: orderby,\r\n</span><span style=\"color: #008080;\">495</span>                    <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">paging</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: paging}\r\n</span><span style=\"color: #008080;\">496</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">497</span>             <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">498</span>                 data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">rows</span><span style=\"color: #800000;\">\'</span>] =<span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">499</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 不需要分页查询时，直接在这里设置总记录数</span>\r\n<span style=\"color: #008080;\">500</span>                 <span style=\"color: #0000ff;\">if</span> page_size <span style=\"color: #0000ff;\">is</span><span style=\"color: #000000;\"> None:\r\n</span><span style=\"color: #008080;\">501</span>                     data[<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">records</span><span style=\"color: #800000;\">\'</span>] =<span style=\"color: #000000;\"> len(result)\r\n</span><span style=\"color: #008080;\">502</span> \r\n<span style=\"color: #008080;\">503</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> data\r\n</span><span style=\"color: #008080;\">504</span> \r\n<span style=\"color: #008080;\">505</span>     <span style=\"color: #0000ff;\">def</span> get_count(self, wheres=<span style=\"color: #800000;\">\'\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">506</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取指定条件记录数量</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">507</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">508</span>         sql =<span style=\"color: #000000;\"> self.get_count_sql(wheres)\r\n</span><span style=\"color: #008080;\">509</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">510</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询存在记录，则返回true</span>\r\n<span style=\"color: #008080;\">511</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">512</span>             <span style=\"color: #0000ff;\">return</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">total</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">513</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> 0\r\n</span><span style=\"color: #008080;\">514</span> \r\n<span style=\"color: #008080;\">515</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_sum(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">516</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取指定条件记录数量</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">517</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">518</span>         sql =<span style=\"color: #000000;\"> self.get_sum_sql(fields, wheres)\r\n</span><span style=\"color: #008080;\">519</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">520</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询存在记录，则返回true</span>\r\n<span style=\"color: #008080;\">521</span>         <span style=\"color: #0000ff;\">if</span> result <span style=\"color: #0000ff;\">and</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">total</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">522</span>             <span style=\"color: #0000ff;\">return</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">total</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">523</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> 0\r\n</span><span style=\"color: #008080;\">524</span> \r\n<span style=\"color: #008080;\">525</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_min(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">526</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取该列记录最小值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">527</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">528</span>         sql =<span style=\"color: #000000;\"> self.get_min_sql(fields, wheres)\r\n</span><span style=\"color: #008080;\">529</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">530</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询存在记录，则返回true</span>\r\n<span style=\"color: #008080;\">531</span>         <span style=\"color: #0000ff;\">if</span> result <span style=\"color: #0000ff;\">and</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">min</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">532</span>             <span style=\"color: #0000ff;\">return</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">min</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">533</span> \r\n<span style=\"color: #008080;\">534</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_max(self, fields, wheres):\r\n</span><span style=\"color: #008080;\">535</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取该列记录最大值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">536</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成sql</span>\r\n<span style=\"color: #008080;\">537</span>         sql =<span style=\"color: #000000;\"> self.get_max_sql(fields, wheres)\r\n</span><span style=\"color: #008080;\">538</span>         result =<span style=\"color: #000000;\"> self.select(sql)\r\n</span><span style=\"color: #008080;\">539</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果查询存在记录，则返回true</span>\r\n<span style=\"color: #008080;\">540</span>         <span style=\"color: #0000ff;\">if</span> result <span style=\"color: #0000ff;\">and</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">max</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">541</span>             <span style=\"color: #0000ff;\">return</span> result[0].get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">max</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">542</span> \r\n<span style=\"color: #008080;\">543</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span>\r\n<span style=\"color: #008080;\">544</span> \r\n<span style=\"color: #008080;\">545</span> \r\n<span style=\"color: #008080;\">546</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span>\r\n<span style=\"color: #008080;\">547</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">## 缓存操作方法 ###</span>\r\n<span style=\"color: #008080;\">548</span> \r\n<span style=\"color: #008080;\">549</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_cache_key(self, pk):\r\n</span><span style=\"color: #008080;\">550</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取缓存key值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">551</span>         <span style=\"color: #0000ff;\">return</span> <span style=\"color: #800000;\">\'\'</span>.join((self.<span style=\"color: #800080;\">__table_name</span>, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">_</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">, str(pk)))\r\n</span><span style=\"color: #008080;\">552</span> \r\n<span style=\"color: #008080;\">553</span>     <span style=\"color: #0000ff;\">def</span> set_model_for_cache(self, pk, value, time=43200<span style=\"color: #000000;\">):\r\n</span><span style=\"color: #008080;\">554</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">更新存储在缓存中的数据库记录，缓存过期时间为12小时</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">555</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成缓存key</span>\r\n<span style=\"color: #008080;\">556</span>         key =<span style=\"color: #000000;\"> self.get_cache_key(pk)\r\n</span><span style=\"color: #008080;\">557</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 存储到nosql缓存中</span>\r\n<span style=\"color: #008080;\">558</span> <span style=\"color: #000000;\">        cache_helper.set(key, value, time)\r\n</span><span style=\"color: #008080;\">559</span> \r\n<span style=\"color: #008080;\">560</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model_for_cache(self, pk):\r\n</span><span style=\"color: #008080;\">561</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">从缓存中读取数据库记录</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">562</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成缓存key</span>\r\n<span style=\"color: #008080;\">563</span>         key =<span style=\"color: #000000;\"> self.get_cache_key(pk)\r\n</span><span style=\"color: #008080;\">564</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 从缓存中读取数据库记录</span>\r\n<span style=\"color: #008080;\">565</span>         result =<span style=\"color: #000000;\"> cache_helper.get(key)\r\n</span><span style=\"color: #008080;\">566</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 缓存中不存在记录，则从数据库获取</span>\r\n<span style=\"color: #008080;\">567</span>         <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">568</span>             result =<span style=\"color: #000000;\"> self.get_model_for_pk(pk)\r\n</span><span style=\"color: #008080;\">569</span> <span style=\"color: #000000;\">            self.set_model_for_cache(pk, result)\r\n</span><span style=\"color: #008080;\">570</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">571</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">572</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">573</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> {}\r\n</span><span style=\"color: #008080;\">574</span> \r\n<span style=\"color: #008080;\">575</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_model_for_cache_of_where(self, where):\r\n</span><span style=\"color: #008080;\">576</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">577</span> <span style=\"color: #800000;\">        通过条件获取记录实体（我们经常需要使用key、编码或指定条件来获取记录，这时可以通过当前方法来获取）\r\n</span><span style=\"color: #008080;\">578</span> <span style=\"color: #800000;\">        :param where: 查询条件\r\n</span><span style=\"color: #008080;\">579</span> <span style=\"color: #800000;\">        :return: 记录实体\r\n</span><span style=\"color: #008080;\">580</span>         <span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">581</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成实体缓存key</span>\r\n<span style=\"color: #008080;\">582</span>         model_cache_key = self.<span style=\"color: #800080;\">__table_name</span> +<span style=\"color: #000000;\"> encrypt_helper.md5(where)\r\n</span><span style=\"color: #008080;\">583</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 通过条件从缓存中获取记录id</span>\r\n<span style=\"color: #008080;\">584</span>         pk =<span style=\"color: #000000;\"> cache_helper.get(model_cache_key)\r\n</span><span style=\"color: #008080;\">585</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 如果主键id存在，则直接从缓存中读取记录</span>\r\n<span style=\"color: #008080;\">586</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> pk:\r\n</span><span style=\"color: #008080;\">587</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> self.get_model_for_cache(pk)\r\n</span><span style=\"color: #008080;\">588</span> \r\n<span style=\"color: #008080;\">589</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 否则从数据库中获取</span>\r\n<span style=\"color: #008080;\">590</span>         result =<span style=\"color: #000000;\"> self.get_model(where)\r\n</span><span style=\"color: #008080;\">591</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">592</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 存储条件对应的主键id值到缓存中</span>\r\n<span style=\"color: #008080;\">593</span>             cache_helper.set(model_cache_key, result.get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">))\r\n</span><span style=\"color: #008080;\">594</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 存储记录实体到缓存中</span>\r\n<span style=\"color: #008080;\">595</span>             self.set_model_for_cache(result.get(self.<span style=\"color: #800080;\">__pk_name</span><span style=\"color: #000000;\">), result)\r\n</span><span style=\"color: #008080;\">596</span>             <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> result\r\n</span><span style=\"color: #008080;\">597</span> \r\n<span style=\"color: #008080;\">598</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> get_value_for_cache(self, pk, column_name):\r\n</span><span style=\"color: #008080;\">599</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">获取指定记录的字段值</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">600</span>         <span style=\"color: #0000ff;\">return</span><span style=\"color: #000000;\"> self.get_model_for_cache(pk).get(column_name)\r\n</span><span style=\"color: #008080;\">601</span> \r\n<span style=\"color: #008080;\">602</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> del_model_for_cache(self, pk):\r\n</span><span style=\"color: #008080;\">603</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">删除缓存中指定数据</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">604</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 生成缓存key</span>\r\n<span style=\"color: #008080;\">605</span>         key =<span style=\"color: #000000;\"> self.get_cache_key(pk)\r\n</span><span style=\"color: #008080;\">606</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> log_helper.info(key)</span>\r\n<span style=\"color: #008080;\">607</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 存储到nosql缓存中</span>\r\n<span style=\"color: #008080;\">608</span> <span style=\"color: #000000;\">        cache_helper.delete(key)\r\n</span><span style=\"color: #008080;\">609</span> \r\n<span style=\"color: #008080;\">610</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> add_relevance_cache_in_list(self, key):\r\n</span><span style=\"color: #008080;\">611</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">将缓存名称存储到列表里————主要存储与记录变更关联的</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">612</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 从nosql中读取全局缓存列表</span>\r\n<span style=\"color: #008080;\">613</span>         cache_list = cache_helper.get(self.<span style=\"color: #800080;\">__cache_list</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">614</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断缓存列表是否有值，有则进行添加操作</span>\r\n<span style=\"color: #008080;\">615</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> cache_list:\r\n</span><span style=\"color: #008080;\">616</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 判断是否已存储列表中，不存在则执行添加操作</span>\r\n<span style=\"color: #008080;\">617</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span> key <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> cache_list:\r\n</span><span style=\"color: #008080;\">618</span> <span style=\"color: #000000;\">                cache_list.append(key)\r\n</span><span style=\"color: #008080;\">619</span>                 cache_helper.set(self.<span style=\"color: #800080;\">__cache_list</span><span style=\"color: #000000;\">, cache_list)\r\n</span><span style=\"color: #008080;\">620</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 无则直接创建全局缓存列表，并存储到nosql中</span>\r\n<span style=\"color: #008080;\">621</span>         <span style=\"color: #0000ff;\">else</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">622</span>             cache_list =<span style=\"color: #000000;\"> [key]\r\n</span><span style=\"color: #008080;\">623</span>             cache_helper.set(self.<span style=\"color: #800080;\">__cache_list</span><span style=\"color: #000000;\">, cache_list)\r\n</span><span style=\"color: #008080;\">624</span> \r\n<span style=\"color: #008080;\">625</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> del_relevance_cache(self):\r\n</span><span style=\"color: #008080;\">626</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">删除关联缓存————将和数据表记录关联的，个性化缓存全部删除</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">627</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 从nosql中读取全局缓存列表</span>\r\n<span style=\"color: #008080;\">628</span>         cache_list = cache_helper.get(self.<span style=\"color: #800080;\">__cache_list</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">629</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 清除已删除缓存列表</span>\r\n<span style=\"color: #008080;\">630</span>         cache_helper.delete(self.<span style=\"color: #800080;\">__cache_list</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">631</span>         <span style=\"color: #0000ff;\">if</span><span style=\"color: #000000;\"> cache_list:\r\n</span><span style=\"color: #008080;\">632</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行删除操作</span>\r\n<span style=\"color: #008080;\">633</span>             <span style=\"color: #0000ff;\">for</span> cache <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> cache_list:\r\n</span><span style=\"color: #008080;\">634</span> <span style=\"color: #000000;\">                cache_helper.delete(cache)\r\n</span><span style=\"color: #008080;\">635</span> \r\n<span style=\"color: #008080;\">636</span>     <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">####################################################################</span></pre>\r\n</div>\r\n<span class=\"cnblogs_code_collapse\">View Code</span></div>\r\n<p>　　从完整代码可以看到，重构后的类多了很多sql生成方法，它们其实是从原方法中分享出sql合成代码，将它们独立出来而已。</p>\r\n<p>&nbsp;</p>\r\n<p>　　接下来我们编写单元测试代码，执行一下事务看看效果</p>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #008080;\"> 1</span> <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">!/usr/bin/evn python</span>\r\n<span style=\"color: #008080;\"> 2</span> <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> coding=utf-8</span>\r\n<span style=\"color: #008080;\"> 3</span> \r\n<span style=\"color: #008080;\"> 4</span> <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> unittest\r\n</span><span style=\"color: #008080;\"> 5</span> <span style=\"color: #0000ff;\">from</span> common <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> db_helper\r\n</span><span style=\"color: #008080;\"> 6</span> <span style=\"color: #0000ff;\">from</span> common.string_helper <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> string\r\n</span><span style=\"color: #008080;\"> 7</span> <span style=\"color: #0000ff;\">from</span> config <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> db_config\r\n</span><span style=\"color: #008080;\"> 8</span> <span style=\"color: #0000ff;\">from</span> logic <span style=\"color: #0000ff;\">import</span><span style=\"color: #000000;\"> product_logic, product_class_logic\r\n</span><span style=\"color: #008080;\"> 9</span> \r\n<span style=\"color: #008080;\">10</span> \r\n<span style=\"color: #008080;\">11</span> <span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> DbHelperTest(unittest.TestCase):\r\n</span><span style=\"color: #008080;\">12</span>     <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">数据库操作包测试类</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">13</span> \r\n<span style=\"color: #008080;\">14</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> setUp(self):\r\n</span><span style=\"color: #008080;\">15</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">初始化测试环境</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">16</span>         <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">------ini------</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">17</span> \r\n<span style=\"color: #008080;\">18</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> tearDown(self):\r\n</span><span style=\"color: #008080;\">19</span>         <span style=\"color: #800000;\">\"\"\"</span><span style=\"color: #800000;\">清理测试环境</span><span style=\"color: #800000;\">\"\"\"</span>\r\n<span style=\"color: #008080;\">20</span>         <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">------clear------</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">21</span> \r\n<span style=\"color: #008080;\">22</span>     <span style=\"color: #0000ff;\">def</span><span style=\"color: #000000;\"> test(self):\r\n</span><span style=\"color: #008080;\">23</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">#############################################</span>\r\n<span style=\"color: #008080;\">24</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 只需要看这里，其他代码是测试用例的模板代码 #</span>\r\n<span style=\"color: #008080;\">25</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">#############################################</span>\r\n<span style=\"color: #008080;\">26</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 测试事务</span>\r\n<span style=\"color: #008080;\">27</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 使用with方法，初始化数据库链接</span>\r\n<span style=\"color: #008080;\">28</span> <span style=\"color: #000000;\">        with db_helper.PgHelper(db_config.DB, db_config.IS_OUTPUT_SQL) as db:\r\n</span><span style=\"color: #008080;\">29</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 实例化product表操作类ProductLogic</span>\r\n<span style=\"color: #008080;\">30</span>             _product_logic =<span style=\"color: #000000;\"> product_logic.ProductLogic()\r\n</span><span style=\"color: #008080;\">31</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 实例化product_class表操作类product_class_logic</span>\r\n<span style=\"color: #008080;\">32</span>             _product_class_logic =<span style=\"color: #000000;\"> product_class_logic.ProductClassLogic()\r\n</span><span style=\"color: #008080;\">33</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 初始化产品分类主键id</span>\r\n<span style=\"color: #008080;\">34</span>             id = 1\r\n<span style=\"color: #008080;\">35</span> \r\n<span style=\"color: #008080;\">36</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 获取产品分类信息（为了查看效果，所以加了这段获取分类信息）</span>\r\n<span style=\"color: #008080;\">37</span>             sql =<span style=\"color: #000000;\"> _product_class_logic.get_model_for_pk_sql(id)\r\n</span><span style=\"color: #008080;\">38</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(sql)\r\n</span><span style=\"color: #008080;\">39</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">40</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">41</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">42</span>                 <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">不存在指定的产品分类</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">43</span>                 <span style=\"color: #0000ff;\">return</span>\r\n<span style=\"color: #008080;\">44</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">----产品分类实体----</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">45</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(result)\r\n</span><span style=\"color: #008080;\">46</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">-------------------</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">47</span> \r\n<span style=\"color: #008080;\">48</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 禁用产品分类</span>\r\n<span style=\"color: #008080;\">49</span>             fields =<span style=\"color: #000000;\"> {\r\n</span><span style=\"color: #008080;\">50</span>                 <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: 0\r\n</span><span style=\"color: #008080;\">51</span> <span style=\"color: #000000;\">            }\r\n</span><span style=\"color: #008080;\">52</span>             sql = _product_class_logic.edit_model_sql(id, fields, returning=<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">53</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(sql)\r\n</span><span style=\"color: #008080;\">54</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">55</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">56</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">57</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行失败，执行回滚操作</span>\r\n<span style=\"color: #008080;\">58</span> <span style=\"color: #000000;\">                db.rollback()\r\n</span><span style=\"color: #008080;\">59</span>                 <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">禁用产品分类失败</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">60</span>                 <span style=\"color: #0000ff;\">return</span>\r\n<span style=\"color: #008080;\">61</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行缓存清除操作</span>\r\n<span style=\"color: #008080;\">62</span> <span style=\"color: #000000;\">            _product_class_logic.del_model_for_cache(id)\r\n</span><span style=\"color: #008080;\">63</span> <span style=\"color: #000000;\">            _product_class_logic.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">64</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">----执行成功后的产品分类实体----</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">65</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(result)\r\n</span><span style=\"color: #008080;\">66</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">-------------------------------</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">67</span> \r\n<span style=\"color: #008080;\">68</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 同步禁用产品分类对应的所有产品</span>\r\n<span style=\"color: #008080;\">69</span>             sql = _product_logic.edit_sql(fields, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">product_class_id=</span><span style=\"color: #800000;\">\'</span> + str(id), returning=<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">70</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(sql)\r\n</span><span style=\"color: #008080;\">71</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行sql语句</span>\r\n<span style=\"color: #008080;\">72</span>             result =<span style=\"color: #000000;\"> db.execute(sql)\r\n</span><span style=\"color: #008080;\">73</span>             <span style=\"color: #0000ff;\">if</span> <span style=\"color: #0000ff;\">not</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">74</span>                 <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行失败，执行回滚操作</span>\r\n<span style=\"color: #008080;\">75</span> <span style=\"color: #000000;\">                db.rollback()\r\n</span><span style=\"color: #008080;\">76</span>                 <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">同步禁用产品分类对应的所有产品失败</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">77</span>                 <span style=\"color: #0000ff;\">return</span>\r\n<span style=\"color: #008080;\">78</span>             <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> 执行缓存清除操作</span>\r\n<span style=\"color: #008080;\">79</span>             <span style=\"color: #0000ff;\">for</span> model <span style=\"color: #0000ff;\">in</span><span style=\"color: #000000;\"> result:\r\n</span><span style=\"color: #008080;\">80</span>                 _product_class_logic.del_model_for_cache(model.get(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">))\r\n</span><span style=\"color: #008080;\">81</span> <span style=\"color: #000000;\">            _product_class_logic.del_relevance_cache()\r\n</span><span style=\"color: #008080;\">82</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">----执行成功后的产品实体----</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">83</span>             <span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(result)\r\n</span><span style=\"color: #008080;\">84</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">---------------------------</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">85</span> \r\n<span style=\"color: #008080;\">86</span> <span style=\"color: #000000;\">            db.commit()\r\n</span><span style=\"color: #008080;\">87</span>             <span style=\"color: #0000ff;\">print</span>(<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">执行成功</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">)\r\n</span><span style=\"color: #008080;\">88</span>         <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\">#############################################</span>\r\n<span style=\"color: #008080;\">89</span> \r\n<span style=\"color: #008080;\">90</span> <span style=\"color: #0000ff;\">if</span> <span style=\"color: #800080;\">__name__</span> == <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">__main__</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">:\r\n</span><span style=\"color: #008080;\">91</span>     unittest.main()</pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>　　细心的朋友可能会发现，在事务处理中，进行编辑操作以后，会执行缓存的清除操作，这是因为我们在ORM中所绑定的缓存自动清除操作，是在对应的执行方法中，而不是sql生成方法里，所以在进行事务时，如果你使用了缓存的方法，在这里就需要手动添加清除缓存操作，不然就会产生脏数据。</p>\r\n<p>&nbsp;</p>\r\n<p>　　执行结果：</p>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #008080;\"> 1</span> ------ini------\r\n<span style=\"color: #008080;\"> 2</span> select * <span style=\"color: #0000ff;\">from</span> product_class  where id = 1\r\n<span style=\"color: #008080;\"> 3</span> ----产品分类实体----\r\n<span style=\"color: #008080;\"> 4</span> [{<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">add_time</span><span style=\"color: #800000;\">\'</span>: datetime.datetime(2018, 8, 17, 16, 14, 54), <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 1, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span>: 1, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">name</span><span style=\"color: #800000;\">\'</span>: <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">饼干</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">}]\r\n</span><span style=\"color: #008080;\"> 5</span> -------------------\r\n<span style=\"color: #008080;\"> 6</span> update product_class set is_enable = 0  where id = 1<span style=\"color: #000000;\"> returning id , is_enable\r\n</span><span style=\"color: #008080;\"> 7</span> ----执行成功后的产品分类实体----\r\n<span style=\"color: #008080;\"> 8</span> [{<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 1, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: 0}]\r\n</span><span style=\"color: #008080;\"> 9</span> -------------------------------\r\n<span style=\"color: #008080;\">10</span> update product set is_enable = 0  where product_class_id=1<span style=\"color: #000000;\"> returning id , is_enable\r\n</span><span style=\"color: #008080;\">11</span> ----执行成功后的产品实体----\r\n<span style=\"color: #008080;\">12</span> [{<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 2, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span>: 0}, {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 7, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span>: 0}, {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 14, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span>: 0}, {<span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">id</span><span style=\"color: #800000;\">\'</span>: 15, <span style=\"color: #800000;\">\'</span><span style=\"color: #800000;\">is_enable</span><span style=\"color: #800000;\">\'</span><span style=\"color: #000000;\">: 0}]\r\n</span><span style=\"color: #008080;\">13</span> ---------------------------\r\n<span style=\"color: #008080;\">14</span> <span style=\"color: #000000;\">执行成功\r\n</span><span style=\"color: #008080;\">15</span> ------clear------</pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size: 16px;\">　　<strong><a href=\"https://pan.baidu.com/s/1GMAw9gOA_sJ8GPUfdnuWXg\" target=\"_blank\">本文对应的源码下载</a>（一些接口进行了重构，有些还没有处理，所以源码可能直接运行不了，下一章节会讲到所有代码使用ORM模块重构内容）</strong></span></p>\r\n<p><span style=\"font-size: 16px;\">&nbsp;</span></p>\r\n<p><span style=\"font-size: 16px; color: #0000ff;\">版权声明：本文原创发表于&nbsp;<a href=\"http://www.cnblogs.com/\" target=\"_blank\"><span style=\"color: #0000ff;\">博客园</span></a>，作者为&nbsp;<strong><a href=\"http://www.cnblogs.com/EmptyFS/\" target=\"_blank\"><span style=\"color: #0000ff;\">AllEmpty</span></a>&nbsp;</strong>本文欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则视为侵权。</span></p>\r\n<p><span style=\"font-size: 16px; color: #0000ff;\">python开发QQ群：669058475&nbsp; &nbsp; 作者博客：http://www.cnblogs.com/EmptyFS/</span></p>\r\n<p><span style=\"font-size: 16px;\">&nbsp;</span></p></div><div id=\"MySignature\" style=\"display: block;\"><div style=\"background-color: #F8F8EE; border: solid 1px #E8E7D0; padding: 10px; margin-bottom: 10px; font-size: 16px; font-weight: bold; color: #06A\">只有将自己置空，才能装进更多的东西！我是陈焕，资深IT码农，爱分享爱学习，一位奔跑在求知路上的践行者。\r\n<br><br>\r\n</div></div>\r\n<div class=\"clear\"></div>\r\n<div id=\"blog_post_info_block\">\r\n<div id=\"BlogPostCategory\">分类: <a href=\"https://www.cnblogs.com/EmptyFS/category/910653.html\" target=\"_blank\">我的第一个python web开发框架</a></div>\r\n<div id=\"EntryTag\">标签: <a href=\"https://www.cnblogs.com/EmptyFS/tag/python/\">python</a></div>\r\n<div id=\"blog_post_info\"><div id=\"green_channel\">\r\n        <a href=\"javascript:void(0);\" id=\"green_channel_digg\" onclick=\"DiggIt(9484686,cb_blogId,1);green_channel_success(this,\'谢谢推荐！\');\">好文要顶</a>\r\n            <a id=\"green_channel_follow\" onclick=\"follow(\'b4073d05-a751-df11-ba8f-001cf0cd104b\');\" href=\"javascript:void(0);\">关注我</a>\r\n    <a id=\"green_channel_favorite\" onclick=\"AddToWz(cb_entryId);return false;\" href=\"javascript:void(0);\">收藏该文</a>\r\n    <a id=\"green_channel_weibo\" href=\"javascript:void(0);\" title=\"分享至新浪微博\" onclick=\"ShareToTsina()\"><img src=\"//common.cnblogs.com/images/icon_weibo_24.png\" alt=\"\"></a>\r\n    <a id=\"green_channel_wechat\" href=\"javascript:void(0);\" title=\"分享至微信\" onclick=\"shareOnWechat()\"><img src=\"//common.cnblogs.com/images/wechat.png\" alt=\"\"></a>\r\n</div>\r\n<div id=\"author_profile\">\r\n    <div id=\"author_profile_info\" class=\"author_profile_info\">\r\n            <a href=\"http://home.cnblogs.com/u/EmptyFS/\" target=\"_blank\"><img src=\"//pic.cnblogs.com/face/129385/20140408130141.png\" class=\"author_avatar\" alt=\"\"></a>\r\n        <div id=\"author_profile_detail\" class=\"author_profile_info\">\r\n            <a href=\"http://home.cnblogs.com/u/EmptyFS/\">AllEmpty</a><br>\r\n            <a href=\"http://home.cnblogs.com/u/EmptyFS/followees\">关注 - 65</a><br>\r\n            <a href=\"http://home.cnblogs.com/u/EmptyFS/followers\">粉丝 - 1840</a>\r\n        </div>\r\n    </div>\r\n    <div class=\"clear\"></div>\r\n    <div id=\"author_profile_honor\"></div>\r\n    <div id=\"author_profile_follow\">\r\n                <a href=\"javascript:void(0);\" onclick=\"follow(\'b4073d05-a751-df11-ba8f-001cf0cd104b\');return false;\">+加关注</a>\r\n    </div>\r\n</div>\r\n<div id=\"div_digg\">\r\n    <div class=\"diggit\" onclick=\"votePost(9484686,\'Digg\')\">\r\n        <span class=\"diggnum\" id=\"digg_count\">0</span>\r\n    </div>\r\n    <div class=\"buryit\" onclick=\"votePost(9484686,\'Bury\')\">\r\n        <span class=\"burynum\" id=\"bury_count\">0</span>\r\n    </div>\r\n    <div class=\"clear\"></div>\r\n    <div class=\"diggword\" id=\"digg_tips\">\r\n    </div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n    currentDiggType = 0;\r\n</script></div>\r\n<div class=\"clear\"></div>\r\n<div id=\"post_next_prev\"><a href=\"https://www.cnblogs.com/EmptyFS/p/9484680.html\" class=\"p_n_p_prefix\">« </a> 上一篇：<a href=\"https://www.cnblogs.com/EmptyFS/p/9484680.html\" title=\"发布于2018-08-16 23:52\">我的第一个python web开发框架（30）——定制ORM（七）</a><br></div>\r\n</div>\r\n\r\n\r\n		</div>', '1');
INSERT INTO `blog_articledetail` VALUES ('2', '<div id=\"cnblogs_post_body\" class=\"blogpost-body\"><div>\r\n<div id=\"2831-1534472713673\" style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-weight: bold\">框架介绍</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\"> entitas是一个超快、超轻量的c# Entity-Component-System (ECS)框架，专门为Unity引擎设计。提供内部缓存和高速的组件访问，经过精心设计，可以在垃圾收集环境中最优地工作。</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"6111-1534473046688\" style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-family: Arial; color: #2e3033; background-color: #ffffff; font-weight: bold\">框架解析</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.5; font-size: 14px\"><span style=\"font-family: Arial; color: #494949; background-color: #ffffff\"> 要理解框架，就需要知道这四种概念，分别是：Entiy实体、Context环境、Group组、Collector收集器。如图，在一个Context中，会有很多Entity，每个Entity都拥有若干Component，Component中只有数据，而Group是拥有相同Component的Entity集合，用于快速查找拥有特定属性的Entity。</span></div>\r\n<p>&nbsp;<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgMAAAHyCAYAAAB2/c12AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACTESURBVHhe7d1PbqPK2gfgbzE9yeTspCcZ9EYi9SD7iHSkLKQVqdfRitT7uLq6E74AxgGMgdgUrvL7DB6dE2PK9c9VP9OJ+b///Pd/FQAQlzAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDAAAMFtGgZ+/fyn+v7v38ljcC3zCyANYYBimF8AaQgDFMP8Akjj+jDw9lx9e/hn0tPb4Tnvr9X3wbHn6le/DMcdP3d8zfwC4CquDFAM8wsgDWGAYphfAGkIAxTD/AJIY9MwAACURxgAgOCEAQAIThgAgOCEAQAIThgAgOCEAQAIThgAgOCEAQAIbtMw8OffH74hjmTML4A0hAGKYX4BpCEMdEa3yt26Ham/Vz/C9/YLAwBpCAMf6np/e/hRvbz3H3se/HwtYeB6wgBAGsLAf39XTw//VE9vU8c6f6uXx8+rBt8enqtfo2NPb2057fHPYNEGjf65Bz9/H85v1Zv58djja/WnO/b+Wn3/eKzfr+1z2zqsLf8eCAMAaQgDzWbb39zH2s2+365mAz5u2F1QGAWAic3+XN80m3vv+eOf2zoeyu//f3f8cM69b5TCAEAawkDzuwIzYWAyLNRXAboNubsy0Dtel9n/dP/h/GbdL+tg4jXbAPJcPY2CSUcYAOBSwsBSGJjY2IcB4Mow0Gz8h0v7A+NP/4crECd1aQkDAFxKGFj6nYFbXBmY0FwZ+Pm7KWfq9wGEAQAuJQx8aDbY0Yb8+dcE7Wbfb1fz/ONmvy4MNJv5zKf6qQ3+aHD1Yjq8zJV/L4QBgDSEgYNmM+1dph+2o92Aj8cHm+66MHC8zN+VMdj8R8f6x5sgMFH++LHZ8u+DMACQhjBAMcwvgDSEAYphfgGkIQxQDPMLII1NwwAAUB5hAACCEwYAIDhhAACCEwYAILhNw4Df9iYl8wsgDWGAYphfAGkIAxTD/AJIQxigGOYXQBrCAMUwvwDSEAYohvkFkIYwQDHML4A09gkD76/V9+4++43n6pfjjq89fiAMAKThygDFML8A0hAGKIb5BZCGMEAxzC+ANIQBimF+AaQhDFAM8wsgDWGAYphfAGlsGgYAgPIIAwAQnDAAAMEJAwAQnDAAAMEJAwAQ3KZhwJ9+kZL5BZCGMEAxzC+ANIQBimF+AaQhDFAM8wsgjTBh4NfPf6pvDwePr9Wfiefcs3to/72HgXqMhJ3b0f9EFiIMNBvhz99nf75399J+YYCU9D+RBQgDv6unhx/Vy3vvsffX6vvDc/Vr8Lx7dT/tFwZISf8T2f2HgWbj+/gkfGK0Qd6rO2r/XYaBt+eJsWk9vR2eczKGoyDn+OXH1/Q/BBDzykAo99N+VwZISf8TWcjfGYjmXtovDJCS/ieyEGHgP//9W708Di8BxgoH99F+YYCU9D+RBQkD3APzCyANYYBimF8AaQgDFMP8Akhj0zAAAJRHGACA4IQBAAhOGACA4IQBAAhOGACA4DYNA/70i5TufX55/9yW/icyYYBiCAM5O3zl9eNr9WfyeP6sX0QmDFAMYeAydbmD+1J8+OrrLH9v/3wYKOF7/61fRCYMUIxs51d9T/wNPhEnDQNX3pjq2s1cGIC8CQM7qRfD4yezAi+l5lD/nOdX2z/P1a+JY2vdJgy0n+if3n5XT934PvyoXt7b4825x8d7euUNnjN6ncXz31+r773XO/vYDlL1P5RAGNhBs1H0Fsnxz7nLpf65z69247t8E0vVvqZeZ8eru731KACMnl+P+VLd5l7n/Pnt6/ePzdc3nVT9DyUQBpKrP3FNffK57lPkfvKpfxHzq/4ng49Pvk9vE8cWpGpfs7mOPpl/1q+7MtA7Z+KfPdKFgQ+D15uoz06sX0QmDKTWbJzDhbi1/2XQi6yp/8lzRkHh2uMHZ+dX6tdfWb/Bcy/4p5RU75+5TTqLMNAPnHX/+Wco2J0wkNzEJ+ui5FP/3OdXsxle0Vep2tfUK+sw8Hn8lmN8y9eGWxMGdlAvdOcX4/zlUv+c51fTR3NXDFZI1b663GvDQFPGwif2uddZPL+5ovLR/sfr+vAaqfofSiAM7KJdcD8vM+exua6XR/2znV8Tm+clUrWv2Yj7Y/fh83XWhYGTOXAc/4m5MTi+dP7o+A3fF9YvIhMGKMa9z6/Y75+JULIz6xeRCQMUQxi4X3Xbt7i6cg3rF5EJAxRDGLg/TQho/ungdr8r0LF+EdmmYQAAKI8wAADBCQMAEJwwAADBCQMAEJwwAADBbRoG/GkOKfnTQlLS/0QmDFAMYYCU9D+RCQMUQxggJf1PZMIAxRAGSEn/E1kxYaC9RezBjb/DPEcR+kcYICX9T2RFhIHx/fRzub9+LqL0jzBASvqfyAoIA7+rp4cf1ct777H31+p7Bjc2yUOc/hEGSEn/E1n+YaDZ2D4+6Z4YbYBRBeqfsGHgZIxHQc/x644fCANEVuaVAXri9E/YMMAu9D+RFfk7AwxF6R9hgJT0P5EVEQb+89+/1ctj/zKfcDAUo3+EAVLS/0RWSBgAYYC09D+RCQMUQxggJf1PZMIAxRAGSEn/E9mmYQAAKI8wAADBCQMAEJwwAADBCQMAENymYcBv45KSvyYgJf1PZMIAxRAGSEn/E5kwQDGEgRlvz4Ovo472Pqzvz3Ftm61fRCYMUAxhYFp93viW1X/+fQ51p09hAK4jDBw0d/7rPlk9vlZ/Jp5zjdTl526L9gsDU+pbWP9TPb1NHeuMb2TVu59/fUXh5+vx+NNbW95nuGjP/Xy8f6wzU/6q8+fmx/z5bRDqndu54EZdwgCRCQMfmoWot3iMf75W6vJzt1X7hYEJ76/V98HmO9Zupv1ymw2023AP/7xQh4lmXJqNttuAP8/vnnNy/lL5x/NHG/jMfBj+vHx+d861c6Mu957nF8wRBppPVqNPKosL7FekLj9327X/3hfri9rXbOYzfTnZ170xqc8/bNyfm2x/g2//f3jloXf+UvlT5/dec3l+LJ3fEgbgOsJAs/C0n3yGRgvUpVKXn7sN2y8MTFgKAxMb52CDvTYMLJW/tJkvzo+F8w+EAbiOMDD1yWRTqcvP3XbtFwam1P073qx7Bp+yO9Ob+eow0C9zqfzFzXxpfggDsAdh4MPw3yi3l7r83G3VfmFgWtO/ow31868J+ht77/ndZnpBGBiO50L5Kzbz+fmxfH6tqfvosa+69/kFc4SBRrvgDC5Tbrp5py4/d9u0/94X62va12yGvf4dltNePTge72+aK8NAv+zTsZsp/3D+/GY+9xprzq+NyjC/4EuEAYpx7/Mrz/ZNbMZ3yvpFZMIAxRAGbkEYgAiEAYohDNyCMAARbBoGAIDyCAMAEJwwAADBCQMAEJwwAADBCQMAENymYcCf5pCSPy0kJf1PZMIAxRAGSEn/E5kwQDGEAVLS/0QmDFAMYYCU9D+RZRMG2tuwHpzckYxby2F8hAFSuvf+r9/D5tft5N7/WYSB8f3Mxz9zW7mMjzBASsIAKeXe/xmEgfpe6D+ql/feY++v1feH5+rX4HncRj7jIwyQkjBASsLAkmZj+fikeWK0AXEbGY2PMEBKd9n/b88T793W8U6UJ+/xUdB3/PLja/o/E3leGSAj+YyPMEBK997/rgzclisDK9Sd5HcE8pXL+AgDpCQMkJIwsMrf6uVxeAlFOMhJHuMjDJCSMEBKwgBsRBggJf1PZMIAxRAGSEn/E5kwQDGEAVLS/0S2aRgAAMojDABAcMIAAAQnDABAcMIAAAQnDABAcJuGAX+aQ0r+tJCUzC9Syr3/hQGKYbEmJfOLlHLvf2GAYlisZ4xulRrtfbjF976bXzPMr7ufX8IAxbBYT6vP+za6zfSff59D3Rb8rhfreiN+fK3+TB37AvPrcsLAF+Xc2Howj8l2gzfW3kqv/xZyfzNd67L2/a6ePubE09vUsc74rpPP1a/uWL3R/Hw9Hn96a8v7XPzbcz8f7x/rzJS/6vy5+T1/frtR9c7tXHBXzfzXr36/fp35dWB+TQoRBpqJ0Bu88c+5K73+W8n9zXSti9r3/lp9n90k2sWuX26zwHUL4uHyb73YtwtmvRB2C+Tn+d1zTs5fKv94/miBnZnPw5+Xz+/OuXZu1OXmPL+adk9sdGtd1D7zqxFhfgUIA3XiG72BFid4Tkqv/3ZyfzNd66L2NYvtzFyYnCu9OVWff1hYPxfB/gLc/n+3UJ+cv1T+1Pm911ye30vntyIs1o3e5jp5fIb5dWB+Tbr/MNAMfJs8h0YTJFel139DRSzWV0iyWE8sbIMF8NrFeqn8pcV2cX4vnH8wu1ifvMZ0f53t/6XzUx/v65570ufLzK++DefXShf1/45iXhkoSun1307ub6ZrXda+en6MF9OeZjEcL+bTi+3qxbpf5lL5i4vt0vy2WHea8bliLTC/pphfnZC/M1Ca0uu/ldzfTNe6tH3N/BgteJ+/7d1feHvP7xa7Cxbr4XxcKH/FYjs/v5fPrzV1Hz32VTnPr3aMx5vi15hfveccLZ9fu/f5VQsRBroBH1wmOjs5clR6/beR+5vpWte0r1msevNjWE776e54vL+orVys+2Wfzr2Z8lcttnOvseb82qiMC94f2c6vyfZ+nfnVY36dCBIGuAf3Pr/ybN/EYnmnzK9bML9yIQxQDIv1LVis74X5dVu5zy9hgGJYrG/BYn0vzK/byn1+bRoGAIDyCAMAEJwwAADBCQMAEJwwAADBbRoG7v23cbktv+1NSuYXKeXe/8IAxbBYk5L5RUq5978wQDEs1qRkfpFS7v0vDFAMizUpmV+klHv/FxMG2jtnHZzcROL2cq/fkhLqb7EmJfOLlHLv/yLCwPgWlPO3pNxf7vVbUkr9LdakZH6RUu79X0AYqG9fObyX9n/eX6vvV97bezu5129JOfW3WJOS+UVKufd//mGg2Zg+PqmeGG1gt5J7/ZYUVH+LNSmFnV8na8Dog4Dj1x0/yH1+lXllICu5129JOfUPu1izC/OLlHLv/yJ/ZyA3pf2OwFgp9bdYk5L5RUq5938RYaC75/XnZZjcNq/c67ekjPpbrEnJ/CKl3Pu/kDAAFmvSMr9IKff+FwYohsWalMwvUsq9/4UBimGxJiXzi5Ry7/9NwwAAUB5hAACCEwYAIDhhAACCEwYAIDhhAACC2zQM+NMVUvKnX6RkfpFS7v0vDFAMizUpmV+klHv/CwMUw2I94+15cG+JaO/D+mZb17bZ/Erg5Pa+Hy6478kW43truc8vYYBiWKyn1ed9G92G+s+/zwXfVvvrhIFlN2lfEwb69/c/3BTt8bX603/eAmEgvTBhoLlNb5dMvzgRS5B7+7aon8V6yu/q6aNPn96mjnXGd6XsLc71FYWfr8fjT29teZ/hoj338/H+sc5M+avOn5sf8+fXfXY8r++CT5/mVwInYaB7bDgHBuPfe/7a8T13fk5yn18hwkAzUXqTZ/xz6XJv31b1s1hPmFpsB9rNtF9us8B2G+7hnxfqMNGMS7NIdxvw5/ndc07OXyr/eP5oA5+ZD8Ofl8/vzrl2btTlml8bm5yfwzlT16sfZpvxH31gmBvfNefnIPf5FSAM1J8ohil0eQEtSe7t265+ub+ZrnVR+5rNfKYvJ/u6Nyb1+YeFs379dpPtL9bt//cX28H5S+VPnd97zeX5sXR+SxhYdpP2Tc6PYRg4ce34Tpyfg9zn1/2HgWYy1p8sxkYLUKlyb9+G9bNYT6gXvrkwMLkw9jbY3vH69b8cBpbKnzq/f87i/Fg4/0AYWHaT9q0JA1Nz4Cvju+L8HOQ+v2JeGbgrubdvu/pZrKfU/TverHsmF+Ppzbx+/VVhoF/mUvmLm/nS/BAGtnKT9k3Nj+ax4fwY1OtL47vu/BzkPr9C/s7Avcm9fVvVz2I9renf0Yb6+dcEp4tl8/xusbwgDAzHc6H8ifPHi/X8/Fg+v9bUffTYV5lfCZyEgTa8fo73OMwejq8e33Xn5yD3+RUiDHQLyuAy0gabUz5yb9829bNYn9cslr3+HZZzWCA7/YVyZRjol306djPlH86f38znXmPN+bVRGebXiZu0rwkDvXH5MBjLWj2ex+Mfofbt45yvjO+q828v9/kVJAxwDyzWtzCxGd8p84uUcu9/YYBiWKxvQRi4F9bn28q9/4UBimGxvgVh4F5Yn28r9/7fNAwAAOURBgAgOGEAAIITBgAgOGEAAIITBgAgOGEAAIITBgAgOGEAAIITBgAguE3DQH0rUl93SSr3Pr+8f27L/CKl3PtfGKAYFmtSMr9IKff+FwYohsWalMwvUsq9/68PA2/P1beHfyYd73T2/lp9Hxx7rn71y3Dc8XPH18yvknn/3Pa4+ZX3+JR+vKD55coAxfDJjZTML1LKvf+FAYphsSYl84uUcu9/YYBiWKxJyfwipdz7f9MwAACURxgAgOCEAQAIThgAgOCEAQAIThgAgOCEAQAIThgAgOCEAQAILqsw8OffH74hCwB2JgwAQHDCAAAEJwwAQHDCAAAEJwwAQHDCAAAEJwwAQHDCAAAEJwwAQHDCAAAEJwwAQHDCAAAEJwwAQHBZhQEAYH/CAAAEJwwAQHDCAAAEJwwAQHBZhQF/TQAA+xMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACC4rMIAALA/YQAAghMGACA4YQAAghMGACA4YQAAgssqDPjTQgDYnzAAAMEJA7CHt+fq28M/R+Y5kBNhABKr5/W3hx/Vy/vnY79+Ple/es8BuCVhYEO/fvrEV7Ik4/f+Wn0fBYGxbt63oWHqysHf6uXx86rCt4d+kGiPPb11P3+or0I8vlZ/Bsd/V0/H88f1GZc/Kq//nGO5wD0RBjYkDJQtxfg1G/zCBnoMAd3zBgGi3YT79RqWuS4M9Df4cZ2an3/+/jx/kjAA90wY2JAwULb0YWD60/l4c26fdzjeBIPxPyn0jq8MA8NP+v3zD69/8hpAJMLAtUa/GNZ3XICbBb1/bLTwOn6742vG7wqnG31tYjM+98l8sLF3+hv89WGg1gaCQ9sXrxIA90YY2JArA2VLMn5NEBluvF8KA835o3Bz7ZWByTI77fMFAohFGNiQMFC2VONXlzu8WvGFMHDYnPv1asrrXS1ofu7O766CzISBwfMnTNfnEBJOrlIA90AY2FCqzYR9pBy/ZgPuLsM3PsPBfBio1eGhd+54Qx78M8hHufXPozDw+bofBq81cXxywxcG4J4JA3DXTq8MAIwJA3DXhAFgmTAAd00YAJZlFQYAgP0JAwAQnDAAAMEJAwAQnDAAAMEJAwAQXFZhoPQ/LfSnkWUzfkBUwsCGbCZly3P8An1PwOBrlXP7au9rv4752vOvdavX9z0XpRAGNiQMlC3d+B0W4os2un0W09vfV6O9/8KtNo3l9s9vpteen17a1z/f/n3mb2qp3x+3f/8JA5sSBsqWZvzaxfDycvdZTG++GM3eVjm9a9ufw2J+S+fbLwyskcP8EQY2dM9hoJ6sx0+2N/t0k1aa8Vv6xDuxWL499/q4O97+tx2Dz9sf98s4js/E650bv7rN/fOOFu5s+LXFfXz+xKZ/ZRg4Pz+7/uvf+XF0++jj4z299g+eM7q75LXnd+bfX9f1//zrz/fPkuX2d+X323Ba/tXrS/2e6c7/MHwfj/uvP8/m279mfGtn63/4p69+fdrntnVYW/4ehIENlV7/c5rJ25uc45/vRarx6xaK6QW8W4x6j02EgcH5zcL3uaA1C8rMeKwZv/qxc21fKn9eW/9+2U15h/Y1/99fBI/WB4P59nX9N1rgv9D+zlw/XHP+fP3nX/crpstZ1z9Lzrf/dP6Oy19q/6Lm/XAuwMzPvy3mx2L9m0BwKL///93xwzlL8yc1YWBDpdd/Wp2YR5P3xpd0U0k6fv1PLoOFpl2MlsLAMEgMx6RZvM6Ox7rxm1uM5stfMDlXtpxTS2Ut9W9rzWLc9MOZTery85f74qr+75l+/XX9s+R8+5fKv34uzPb94vy7dn6sq3/T94/P1dPHa02Vs2b+pCYMbKj0+k9qJvZhExsYvQHuwD7jVy8eH/03t9l/MQzUmsWmG5uTTyXdmPUNz19ajM6Wv2RyY5lo0xc3gKPF9l272H9q+mDrMLByfC7u/57p+q/rnyXn279Q/tXry9T7o2dx/l05P1bXv32dc/26Zv6kJgxsqPT6T5tIvndqt/FrFpC1m9XUYjc3JodF57jorxu/9YvRuPwFTVvnPpkdTD5vjaX2LfVv6+LN/ODy87/6/vpi//dMv/66/llyvv1L5X+1/WNt+Wf7fnH+XTs/1tW/6/u6nKmxWzN/UhMGNlR6/c85N4HvzV7j1ywMvcVm0L/dJ43j8dPFamk8uoWn+3nN+I3rNGdc/rzTxbqpz/i1Lg4DS+1bt9ivaf9cu685f8349H2t/z9Nn7euf5acb/9y+V9t/1jz2mfnztL8u35+LNa/Lu9Yvzo8jF7vw1z5exEGNlR6/c9r3zCDy2BXvHlzlWT8us29b/ymHzznY9Gofx4tVoPzB30/cfxkUVkzfqPnHI+vKX9JuwDOnn9FGJhvX3tsebP7QvsHx7c4f+I5c+d/qf+XXr89fm0YOHmdL5U/UcdB/yxrNtPe+cP38dz8W9v+c+2bONY/3gSBifLHj82Wvw9hYEP3GwZiMH5AVMLAhmwmZTN+QFTCwIZsJmUzfkBUWYUBAGB/wgAABCcMAEBwwgAABCcMAEBwWYUBf03ALRk/ICphYEM2k7IlH7/RtxHuM1cmvmFtpG53+m8+O3zD2pe/2W5DN+n/e5HB+JGUMLAhYaBsacdv+jvJ01sOA50mFNxtGEjb//X309/3e18YuHfCwIaEgbIlHb+rvnv/GrmEgRtL3P/3Hwa4d8LAhm5Z/+bOWd0l0ALTew71v10YOHzq6to/el5Xr2azPjxnfT27MNB/jelbrjblnwkDg/EZ1G9c91Y/fPTrfVp+V7/+zWTG9Vt+jUULYeB8+2qnr9+99qBtfV8MVcPX/3B8D3T903v+xI105t4/s/On6ZdRf48ey2L8SE4Y2NCt6t8sBL036fjn3OVS/xTjN1hIB7oNp10o+6/bnNNb0I9ldI9NLeBnfS7Ex8W3uWva6cbYvM5Ev9eP9xfuZnxGG85RXfaZsZsuv6vfaPM5Ox9O+2vOse9OfLZ/qX3T9R6qz7l07pzM98Fm37Z3LgyMzx//fOyDyflzZv5NtHf68bTjx36EgQ3dpv51Ih9tDAufgvKST/2Tjt+5Nk0+PuyTZnEdbL4TfXbWxGZy5vzxIn7WxCfTVl3u+XGbLn9pszs9vrqefV+ZU6P2Na+3cO7lYWBiLL4UBibOH7V1cf4svd7BTceP5ISBDd2k/s0bv07mY2s3ixvLqP5Jx+/cZjTaeFrDBfS6xXNqcf9iGJgao5M6txvi1CbSmS5/aTPZ6JPluf4/HptvX1P37thEH10cBqbqtbQ5949P1b3xOb7L86c3H+ryJsa2dtPxIzlhYEO3qf/0wl6OfOqfdPzObUaTjw/7ZHkxnzOxWH8pDEws3lMBpn5soY5z5S9uJv2N7pK+ONf/a9t31D5/XIctw0DTT8fXX+qf5ffPmvnT1b9+7rl23HT8SE4Y2NCt6j9M3uXJpf5Jx+8Lm1HTH73FdHoRXut0sT7X39OvU282/fPbnweb5dm2DU2Xv2azWy570dk6rmjfyFQ7msdmzjlvNP5120evPxivph0zxyesmj9NuR/z//F8X990/EhOGNjQ7erfviHLTd951D/p+M1umIcNqDPaVFYt5mct9e3E8fFzug2q8fEp9O2jLcc6Lp2/7vj5zeTQ/rPnrzTX/19t32h8WqPnfaV+3QbflT1q/+B43Yb650EdJurYe/118+dQxsnzJsoelN8eTz5+JCcMbKj0+kdn/DLUbITjy+DjT/N3ZhwGdjGxqW8h4vgVShjYkM2kbMYvQ82n9tFmMrnB3JEbhIF67id5zYjjVyhhYEM2k7IZvzw1G1X/EvO9byQ7hoHPvk337/rhxq9QWYUBAGB/wgAABCcMAEBwwgAABCcMAEBwwgAABCcMbMifpgFQImFgQ8IAACUSBjYkDABQImGgttE3fgkDAJQoqzBQ34rzVptpcxvQK7+SUxiYd8vxZZnxgbiEgZ56M7/me7OFgXk2m7wZH4hLGBhr7rJ12e01hYF5Npu8GR+I6/Zh4LD5TjluyM0tL/vHRpfzrz3e1z33gt8hEAYm5DC+jp8/vmZ8gLvnykCPfyZIyyfPvBkfiEsYOKhf++QT1RcJA/NsNnkzPhCXMFDzp4W7sNnkzfhAXFmFgdIJAwCUSBjYkDAAQImEgQ0JAwCUSBgAgOCEAQAIThgAgOCEAQAIThgAgOCEAQAIThjYkD8tnJd7/0QfP/MX4hIGNmQxnScM5M38hbiEgQ1ZTOcJA3kzfyEuYWBDFtN5wkDezF+ISxjYUMmLaX3Hum8PBxvcwXGKMJA3YQDiEgY2VOpi2gSBn7/P/rwVYSBvwgDEJQxsqMzF9Hf19PCjennvPfb+Wn1/eK5+DZ53PWEgb8IAxCUMbKjIxbTZ+Hv/RHA0CggbEAbyJgxAXMLAhspcTCeuDCQiDORNGIC4hIENlbqYpvodgTFhIG/CAMQlDGyo3MX0b/XyOPpnAr9AGI4wAHEJAxuymM4TBvJm/kJcwsCGLKbzhIG8mb8QlzCwIYvpPGEgb+YvxCUMAEBwwgAABCcMAEBwwgAABCcMAEBwwgAABCcMbMifZs3zp4V5M38hLmFgQxbTecJA3sxfiEsY2JDFdJ4wkDfzF+ISBjZkMZ0nDOTN/IW4hIENpVxMm9sMd3cUfHyt/kw8J3fX9M8e7Y8+fsIAxCUMbCjVYtpsJL1bCo9/LsWl/bNX+6OPnzAAcQkDG0qzmP6unh5+VC/vvcfeX6vvD8/Vr8Hz8ndZ/+zX/ujjJwxAXMLAhpIsps3G8fFJ8sRogynARf2zY/ujj58wAHEJAxtKs5hOfLIs1GX9s1/7o4+fMABxCQMbSrWYlvo7AmOX9s9e7Y8+fsIAxCUMbCjdYvq3ennsLi8fFBgOLu+ffdofffyEAYhLGNiQxXRe7v0TffzMX4hLGNiQxXSeMJA38xfiEgY2ZDGdJwzkzfyFuIQBAAhOGACA4IQBAAhOGACA4IQBAAhOGGA3fls9b8YH4hIG2I3NJm/GB+ISBtiNzSZvxgfiEgbYjc0mb8YH4hIGNlTfnc5iel7um03O49fc+bC7ydHja/Vn4jnXEgYgLmFgQ8LAPGHgMk0Q6N3lcPzzVoQBiEsY2JAwME8YuMTv6unhR/Xy3nvs/bX6/vBc/Ro873rCAMQlDFzr7Xl4n/qep7fDc5rFu39stJDf+/GDs5vNLeu3Zvxu6aTunVFA2IAwAHEJAxtyZWCeKwOXmLgykIgwAHEJAxsSBuYJA5ep65XidwTGhAGISxjYkDAwTxi41N/q5XH0zwR+gRDYkDDAbmw2eTM+EJcwwG5sNnkzPhCXMMBubDZ5Mz4QlzAAAMEJAwAQnDAAAMEJAwAQnDAAAMEJAwAQnDDAbvzpWt6MD8QlDLAbm03ejA/EJQywG5tN3owPxCUMsBubTd6MD8QlDLCbkjeb5jbC3R0DH1+rPxPPKZ0wAHEJA+ym1M2mCQK9WwaPf74XwgDEJQywmzI3m9/V08OP6uW999j7a/X94bn6NXhe+YQBiEsYYDdFbjbNxt/7J4KjUUC4A8IAxCUMsJu7uTJwp4QBiEsYYDelbjb3+jsCY8IAxCUMsJtyN5u/1cvj6J8J/AIhcEeEAXZjs8mb8YG4hAF2Y7PJm/GBuIQBdmOzyZvxgbiEAQAIThgAgOCEAQAIThgAgOCEAQAIThgAgOCEAXbjT9fyZnwgLmGA3dhs8mZ8IC5hgN3YbPJmfCAuYYDd2GzyZnwgLmGA3aTcbJrbDHd3FHx8rf5MPCdnOdRfGIC4hAF2k2qzaTbS3i2Fxz/nLpf6CwMQlzDAbtJsNr+rp4cf1ct777H31+r7w3P1a/C8XOVTf2EA4hIG2E2SzabZOD8+SZ8YbbC5yqj+wgDEJQywm92uDBQln/oLAxCXMMBuUm02pf2OwFgu9RcGIC5hgN2k22z+Vi+P/UvspYWDPOovDEBcwgC7sdnkzfhAXMIAu7HZ5M34QFzCALux2eTN+EBcwgAABCcMAEBwwgAABCcMAEBwwgAABCcMAEBwwgAABCcMAEBwwgAABCcMsJv67ny+4S5fxgfiEgbYjc0mb8YH4hIG2I3NJm/GB+ISBkjr7Xl4n/6ep7fDc95fq++DY8/Vr34Zjqc7vmZ8gLsnDLAbnzzzZnwgLmGA3dhs8mZ8IC5hgN3YbPJmfCAuYQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACA4YQAAghMGACC0/1X/DwIXXehl+9V1AAAAAElFTkSuQmCC\" alt=\"\"></p>\r\n<div>&nbsp;</div>\r\n<div id=\"5195-1534472949029\" style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Entity</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">Entity<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">实体是保存数据的容器，用于表示应用程序中的某些对象。可以以IComponent的形式从实体中添加、替换或删除数据。实体有相应的事件来让你知道组件是否被添加、替换或删除。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4198-1534473530040\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-family: Arial; color: #2e3033; background-color: #ffffff; font-weight: bold\">Context</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">Context环境是用来创建和销毁entity的工厂，用它来过滤感兴趣的entity。</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"2672-1534473206817\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Group</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">Group<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">支持对Context中的实体进行超级快速过滤。当实体发生变化时，它们会不断更新，并且可以立即返回实体组。假设有数千个实体，而你只想要那些具有PositionComponent的实体——只需为这个Group询问Context，就可以很方便的获得结果。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4911-1534473908370\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-family: Arial; color: #2e3033; background-color: #ffffff; font-weight: bold\">Collector</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">Collector <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">收集器提供了一种随时间变化对组中的更改作出反应的简单方法。它能很方便的汇总处理特定的Entity。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"2775-1534473207317\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-weight: bold\">基本使用</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"7265-1534474599393\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Group </span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">Group总是最新的，并且包含与指定匹配程序匹配的所有实体。每个环境都有一个特定的匹配器类型——如果在你的游戏环境中寻找实体(比如游戏实体)，你需要使用</span>GameMatcher</div>\r\n<div>\r\n<div class=\"cnblogs_Highlighter sh-gutter\">\r\n<div><div id=\"highlighter_81904\" class=\"syntaxhighlighter  csharp\"><div class=\"toolbar\"><span><a href=\"#\" class=\"toolbar_item command_help help\">?</a></span></div><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td class=\"gutter\"><div class=\"line number1 index0 alt2\">1</div><div class=\"line number2 index1 alt1\">2</div><div class=\"line number3 index2 alt2\">3</div><div class=\"line number4 index3 alt1\">4</div><div class=\"line number5 index4 alt2\">5</div><div class=\"line number6 index5 alt1\">6</div><div class=\"line number7 index6 alt2\">7</div><div class=\"line number8 index7 alt1\">8</div><div class=\"line number9 index8 alt2\">9</div><div class=\"line number10 index9 alt1\">10</div><div class=\"line number11 index10 alt2\">11</div><div class=\"line number12 index11 alt1\">12</div><div class=\"line number13 index12 alt2\">13</div><div class=\"line number14 index13 alt1\">14</div><div class=\"line number15 index14 alt2\">15</div><div class=\"line number16 index15 alt1\">16</div><div class=\"line number17 index16 alt2\">17</div><div class=\"line number18 index17 alt1\">18</div><div class=\"line number19 index18 alt2\">19</div><div class=\"line number20 index19 alt1\">20</div><div class=\"line number21 index20 alt2\">21</div><div class=\"line number22 index21 alt1\">22</div></td><td class=\"code\"><div class=\"container\"><div class=\"line number1 index0 alt2\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">context = contexts.game;</code></div><div class=\"line number2 index1 alt1\">&nbsp;</div><div class=\"line number3 index2 alt2\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">movables = context.GetGroup(GameMatcher.Movable);</code></div><div class=\"line number4 index3 alt1\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">count = movables.count; </code><code class=\"csharp comments\">// count is 0, the group is empty</code></div><div class=\"line number5 index4 alt2\">&nbsp;</div><div class=\"line number6 index5 alt1\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">entity1 = context.CreateEntity();</code></div><div class=\"line number7 index6 alt2\"><code class=\"csharp plain\">entity1.isMovable = </code><code class=\"csharp keyword\">true</code><code class=\"csharp plain\">;</code></div><div class=\"line number8 index7 alt1\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">entity2 = context.CreateEntity();</code></div><div class=\"line number9 index8 alt2\"><code class=\"csharp plain\">entity2.IsMovable = </code><code class=\"csharp keyword\">true</code><code class=\"csharp plain\">;</code></div><div class=\"line number10 index9 alt1\">&nbsp;</div><div class=\"line number11 index10 alt2\"><code class=\"csharp plain\">count = movables.count; </code><code class=\"csharp comments\">// count is 2, the group contains the entity1 and entity2</code></div><div class=\"line number12 index11 alt1\">&nbsp;</div><div class=\"line number13 index12 alt2\"><code class=\"csharp comments\">// GetEntities() always provides an up to date list</code></div><div class=\"line number14 index13 alt1\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">movableEntities = movables.GetEntities();</code></div><div class=\"line number15 index14 alt2\"><code class=\"csharp keyword\">foreach</code> <code class=\"csharp plain\">(</code><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">e </code><code class=\"csharp keyword\">in</code> <code class=\"csharp plain\">movableEntities) {</code></div><div class=\"line number16 index15 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp comments\">// Do sth</code></div><div class=\"line number17 index16 alt2\"><code class=\"csharp plain\">}</code></div><div class=\"line number18 index17 alt1\">&nbsp;</div><div class=\"line number19 index18 alt2\"><code class=\"csharp plain\">entity1.Destroy();</code></div><div class=\"line number20 index19 alt1\"><code class=\"csharp plain\">entity2.Destroy();</code></div><div class=\"line number21 index20 alt2\">&nbsp;</div><div class=\"line number22 index21 alt1\"><code class=\"csharp plain\">count = movables.count; </code><code class=\"csharp comments\">// count is 0, the group is empty</code></div></div></td></tr></tbody></table></div></div>\r\n</div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div id=\"3318-1534473207382\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"9022-1534474893144\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Matcher</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">Matcher匹配器由代码生成器生成，可以组合。匹配器通常用于从感兴趣的上下文中获取实体组。需要在匹配器前加上你感兴趣的上下文名称(例如GameMatcher, InputMatcher等)。</span></div>\r\n<div>\r\n<div class=\"cnblogs_Highlighter sh-gutter\">\r\n<div><div id=\"highlighter_221385\" class=\"syntaxhighlighter  csharp\"><div class=\"toolbar\"><span><a href=\"#\" class=\"toolbar_item command_help help\">?</a></span></div><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td class=\"gutter\"><div class=\"line number1 index0 alt2\">1</div><div class=\"line number2 index1 alt1\">2</div><div class=\"line number3 index2 alt2\">3</div><div class=\"line number4 index3 alt1\">4</div><div class=\"line number5 index4 alt2\">5</div><div class=\"line number6 index5 alt1\">6</div><div class=\"line number7 index6 alt2\">7</div><div class=\"line number8 index7 alt1\">8</div><div class=\"line number9 index8 alt2\">9</div><div class=\"line number10 index9 alt1\">10</div></td><td class=\"code\"><div class=\"container\"><div class=\"line number1 index0 alt2\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">matcher = GameMatcher.Movable;</code></div><div class=\"line number2 index1 alt1\">&nbsp;</div><div class=\"line number3 index2 alt2\"><code class=\"csharp plain\">GameMatcher.AllOf(GameMatcher.Movable, GameMatcher.Position);</code></div><div class=\"line number4 index3 alt1\">&nbsp;</div><div class=\"line number5 index4 alt2\"><code class=\"csharp plain\">GameMatcher.AnyOf(GameMatcher.Move, GameMatcher.Position);</code></div><div class=\"line number6 index5 alt1\">&nbsp;</div><div class=\"line number7 index6 alt2\"><code class=\"csharp plain\">GameMatcher</code></div><div class=\"line number8 index7 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.AllOf(GameMatcher.Position)</code></div><div class=\"line number9 index8 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.AnyOf(GameMatcher.Health, GameMatcher.Interactive)</code></div><div class=\"line number10 index9 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.NoneOf(GameMatcher.Animating);</code></div></div></td></tr></tbody></table></div></div>\r\n</div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"7273-1534474895039\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Systems</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">entitas中有四种Systems：</div>\r\n<ul>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">IInitializeSystem:</span> 只执行一次 (<span style=\"font-family: monospace\">system.Initialize()</span>)</li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">IExecuteSystem:</span> 每帧执行 (<span style=\"font-family: monospace\">system.Execute()</span>)</li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">ICleanupSystem:</span> <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">在其他系统完成后每一帧执行</span>(system.Cleanup())</li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">ReactiveSystem:</span> <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">当观察的group改变时执行</span>(<span style=\"font-family: monospace\">system.Execute(Entity[])</span>)</li>\r\n</ul>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">用法实例如下：\r\n<div class=\"cnblogs_Highlighter sh-gutter\">\r\n<div><div id=\"highlighter_439816\" class=\"syntaxhighlighter  csharp\"><div class=\"toolbar\"><span><a href=\"#\" class=\"toolbar_item command_help help\">?</a></span></div><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td class=\"gutter\"><div class=\"line number1 index0 alt2\">1</div><div class=\"line number2 index1 alt1\">2</div><div class=\"line number3 index2 alt2\">3</div><div class=\"line number4 index3 alt1\">4</div><div class=\"line number5 index4 alt2\">5</div><div class=\"line number6 index5 alt1\">6</div><div class=\"line number7 index6 alt2\">7</div><div class=\"line number8 index7 alt1\">8</div><div class=\"line number9 index8 alt2\">9</div><div class=\"line number10 index9 alt1\">10</div><div class=\"line number11 index10 alt2\">11</div><div class=\"line number12 index11 alt1\">12</div><div class=\"line number13 index12 alt2\">13</div><div class=\"line number14 index13 alt1\">14</div><div class=\"line number15 index14 alt2\">15</div><div class=\"line number16 index15 alt1\">16</div><div class=\"line number17 index16 alt2\">17</div><div class=\"line number18 index17 alt1\">18</div><div class=\"line number19 index18 alt2\">19</div><div class=\"line number20 index19 alt1\">20</div><div class=\"line number21 index20 alt2\">21</div><div class=\"line number22 index21 alt1\">22</div><div class=\"line number23 index22 alt2\">23</div><div class=\"line number24 index23 alt1\">24</div><div class=\"line number25 index24 alt2\">25</div><div class=\"line number26 index25 alt1\">26</div><div class=\"line number27 index26 alt2\">27</div><div class=\"line number28 index27 alt1\">28</div><div class=\"line number29 index28 alt2\">29</div><div class=\"line number30 index29 alt1\">30</div><div class=\"line number31 index30 alt2\">31</div><div class=\"line number32 index31 alt1\">32</div><div class=\"line number33 index32 alt2\">33</div><div class=\"line number34 index33 alt1\">34</div></td><td class=\"code\"><div class=\"container\"><div class=\"line number1 index0 alt2\"><code class=\"csharp keyword\">public</code> <code class=\"csharp keyword\">class</code> <code class=\"csharp plain\">MoveSystem : IExecuteSystem {</code></div><div class=\"line number2 index1 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">public</code> <code class=\"csharp keyword\">void</code> <code class=\"csharp plain\">Execute() {</code></div><div class=\"line number3 index2 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp comments\">// Do sth</code></div><div class=\"line number4 index3 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number5 index4 alt2\"><code class=\"csharp plain\">}</code></div><div class=\"line number6 index5 alt1\">&nbsp;</div><div class=\"line number7 index6 alt2\"><code class=\"csharp keyword\">public</code> <code class=\"csharp keyword\">class</code> <code class=\"csharp plain\">CreateLevelSystem : IInitializeSystem {</code></div><div class=\"line number8 index7 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">public</code> <code class=\"csharp keyword\">void</code> <code class=\"csharp plain\">Initialize() {</code></div><div class=\"line number9 index8 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp comments\">// Do sth</code></div><div class=\"line number10 index9 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number11 index10 alt2\"><code class=\"csharp plain\">}</code></div><div class=\"line number12 index11 alt1\">&nbsp;</div><div class=\"line number13 index12 alt2\"><code class=\"csharp keyword\">public</code> <code class=\"csharp keyword\">class</code> <code class=\"csharp plain\">RenderPositionSystem: ReactiveSystem&lt;GameEntity&gt; {</code></div><div class=\"line number14 index13 alt1\">&nbsp;</div><div class=\"line number15 index14 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">public</code> <code class=\"csharp plain\">RenderPositionSystem(Contexts contexts) : </code><code class=\"csharp keyword\">base</code><code class=\"csharp plain\">(contexts.Game) {</code></div><div class=\"line number16 index15 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class=\"line number17 index16 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number18 index17 alt1\">&nbsp;</div><div class=\"line number19 index18 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">protected</code> <code class=\"csharp keyword\">override</code> <code class=\"csharp plain\">Collector&lt;GameEntity&gt; GetTrigger(IContext&lt;GameEntity&gt; context) {</code></div><div class=\"line number20 index19 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">return</code> <code class=\"csharp plain\">context.CreateCollector(GameMatcher.Position);</code></div><div class=\"line number21 index20 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number22 index21 alt1\">&nbsp;</div><div class=\"line number23 index22 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">protected</code> <code class=\"csharp keyword\">override</code> <code class=\"csharp keyword\">bool</code> <code class=\"csharp plain\">Filter(GameEntity entity) {</code></div><div class=\"line number24 index23 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp comments\">// check for required components (here it is position and view)</code></div><div class=\"line number25 index24 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">return</code> <code class=\"csharp plain\">entity.hasPosition &amp;&amp; entity.hasView;</code></div><div class=\"line number26 index25 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number27 index26 alt2\">&nbsp;</div><div class=\"line number28 index27 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">protected</code> <code class=\"csharp keyword\">override</code> <code class=\"csharp keyword\">void</code> <code class=\"csharp plain\">Execute(List&lt;GameEntity&gt; entities) {</code></div><div class=\"line number29 index28 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp keyword\">foreach</code> <code class=\"csharp plain\">(</code><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">e </code><code class=\"csharp keyword\">in</code> <code class=\"csharp plain\">entities) {</code></div><div class=\"line number30 index29 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp comments\">// do stuff to the matched entities</code></div><div class=\"line number31 index30 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">e.view.gameObject.transform.position = e.position.position;</code></div><div class=\"line number32 index31 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number33 index32 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">}</code></div><div class=\"line number34 index33 alt1\"><code class=\"csharp plain\">}</code></div></div></td></tr></tbody></table></div></div>\r\n</div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\">最后需要注意的是，需要<span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">创建一个管理System的System，因为一个游戏开发过程中，不可能只有一个System的，为了方便管理，便有了【Feature】System的概念。这个类要继承Feature，在构造器里Add所有System进去。Feature就像一个管理System的SystemManager。</span></div>\r\n<div>\r\n<div class=\"cnblogs_Highlighter sh-gutter\">\r\n<div><div id=\"highlighter_660076\" class=\"syntaxhighlighter  csharp\"><div class=\"toolbar\"><span><a href=\"#\" class=\"toolbar_item command_help help\">?</a></span></div><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tbody><tr><td class=\"gutter\"><div class=\"line number1 index0 alt2\">1</div><div class=\"line number2 index1 alt1\">2</div><div class=\"line number3 index2 alt2\">3</div><div class=\"line number4 index3 alt1\">4</div><div class=\"line number5 index4 alt2\">5</div><div class=\"line number6 index5 alt1\">6</div><div class=\"line number7 index6 alt2\">7</div><div class=\"line number8 index7 alt1\">8</div><div class=\"line number9 index8 alt2\">9</div><div class=\"line number10 index9 alt1\">10</div><div class=\"line number11 index10 alt2\">11</div></td><td class=\"code\"><div class=\"container\"><div class=\"line number1 index0 alt2\"><code class=\"csharp keyword\">var</code> <code class=\"csharp plain\">systems = </code><code class=\"csharp keyword\">new</code> <code class=\"csharp plain\">Systems(contexts)</code></div><div class=\"line number2 index1 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.Add(</code><code class=\"csharp keyword\">new</code> <code class=\"csharp plain\">CreateLevelSystem(contexts))</code></div><div class=\"line number3 index2 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.Add(</code><code class=\"csharp keyword\">new</code> <code class=\"csharp plain\">UpdateBoardSystem(contexts))</code></div><div class=\"line number4 index3 alt1\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.Add(</code><code class=\"csharp keyword\">new</code> <code class=\"csharp plain\">MoveSystem(contexts))</code></div><div class=\"line number5 index4 alt2\"><code class=\"csharp spaces\">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=\"csharp plain\">.Add(</code><code class=\"csharp keyword\">new</code> <code class=\"csharp plain\">RenderPositionSystem(contexts));</code></div><div class=\"line number6 index5 alt1\">&nbsp;</div><div class=\"line number7 index6 alt2\"><code class=\"csharp comments\">// Call once on start</code></div><div class=\"line number8 index7 alt1\"><code class=\"csharp plain\">systems.Initialize();</code></div><div class=\"line number9 index8 alt2\">&nbsp;</div><div class=\"line number10 index9 alt1\"><code class=\"csharp comments\">// Call every frame</code></div><div class=\"line number11 index10 alt2\"><code class=\"csharp plain\">systems.Execute();</code></div></div></td></tr></tbody></table></div></div>\r\n</div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4013-1534473207777\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-weight: bold\">System详解</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">总共有上述四种Systems，在实际开发中，需要<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">为应用程序中的每个任务或行为创建systems，并按照定义的顺序执行它们。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"2849-1534475695840\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">InitializeSystem</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">InitializeSystem<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">在程序开始时运行一次。它实现接口IInitializeSystem，后者定义了Initialize()方法。这是您设置初始游戏状态的地方，类似于Unity的Start()方法。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">using</span><span style=\"color: #000000\"> Entitas;\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> MyInitSystem : IInitializeSystem {\r\n\r\n    </span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">void</span><span style=\"color: #000000\"> Initialize() {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> Initialization code here</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"1916-1534473207844\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">ExecuteSystem</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">ExecuteSystem<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">每帧执行一次。它实现接口IExecuteSystem，接口定义了Execute()方法。这是放置需要每帧执行的代码的地方，类似于Unity的Update()方法。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">using</span><span style=\"color: #000000\"> Entitas;\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> MyExecSystem : IExecuteSystem {\r\n\r\n    </span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">void</span><span style=\"color: #000000\"> Execute() {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> per-frame code goes here</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"3075-1534473207910\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">CleanupSystem</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">在所有其他systems完成它们的工作之后，</span><span style=\"font-family: Arial\">CleanupSystem</span><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">在每个帧的末尾运行。它实现了接口ICleanupSystem，接口定义了方法Cleanup()。如果想要创建只存在于一帧的实体，那么这个工具非常有用。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> MyCleanupSystem : ICleanupSystem {\r\n \r\n    </span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">void</span><span style=\"color: #000000\"> Cleanup() {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> cleanup code here \r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> runs after every execute and reactive system has completed</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4713-1534473208008\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">ReactiveSystem</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial\">ReactiveSystem</span><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">在底层是使用了group观察者。通过它，你可以轻而易举的拥有发生改变的你感兴趣的实体。假设你在战场上有100个战斗单位，但是只有10个单位改变了他们的位置。不使用普通的IExecuteSystem，根据位置更新所有100个视图，您可以使用IReactiveSystem，它只更新10个更改单元的视图。所以效率很高。与其他system不同，ReactiveSystem继承自基类ReactiveSystem</span>，而不是实现接口。entitas为游戏中的每个context生成一个实体类型。如果您的context是<span style=\"font-family: Arial\">Game, GameState and Input</span>，那么将生成三种类型:GameEntity、GameStateEntity和InputEntity。<span style=\"font-family: Arial\">ReactiveSystem</span>要求提供它们响应的特定context和关联实体类型。<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">基类定义了一些必须实现的抽象方法。首先，须创建一个构造函数，该构造函数调用基构造函数并为其提供适当的context。必须重写3个方法:GetTrigger()返回一个Collector收集器，它告诉system要响应什么事件。Filter()对collector收集器返回的实体执行最后检查，确保它们在对每个实体调用Execute()之前都附加了所需的组件。Execute()是游戏逻辑的主要位置。需要注意的是:不应该尝试将ReactiveSystem</span>和ExecuteSystem<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">相结合，只需将ReactiveSystem看作是</span>ExecuteSystem<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">的一种特殊情况。所有其他接口都可以混合使用。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">using</span><span style=\"color: #000000\"> System.Collections.Generic;\r\n</span><span style=\"color: #0000ff\">using</span><span style=\"color: #000000\"> Entitas;\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> MyReactiveSystem : ReactiveSystem&lt;MyContextEntity&gt;<span style=\"color: #000000\"> {\r\n\r\n    </span><span style=\"color: #0000ff\">public</span> MyReactiveSystem (Contexts contexts) : <span style=\"color: #0000ff\">base</span><span style=\"color: #000000\">(contexts.MyContext) {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> pass the context of interest to the base constructor</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span> ICollector&lt;MyContextEntity&gt; GetTrigger(IContext&lt;MyContextEntity&gt;<span style=\"color: #000000\"> context) {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> specify which component you are reacting to\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(MyContextMatcher.MyComponent);\r\n\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> you can also specify which type of event you need to react to\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(MyContextMatcher.MyComponent.Added()); </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> the default\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(MyContextMatcher.MyComponent.Removed());\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(MyContextMatcher.MyComponent.AddedOrRemoved());\r\n\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> combine matchers with AnyOf and AllOf\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(LevelMatcher.AnyOf(MyContextMatcher.Component1, MyContextMatcher.Component2));\r\n\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> use multiple matchers\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(LevelMatcher.MyContextMatcher, MyContextMatcher.Component2.Removed());\r\n\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> or any combination of all the above\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> return context.CreateCollector(LevelMatcher.AnyOf(MyContextMatcher.Component1, MyContextMatcher.Component2),\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\">                                LevelMatcher.Component3.Removed(),\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\">                                LevelMatcher.AllOf(MyContextMatcher.C4, MyContextMatcher.C5).Added());</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span> <span style=\"color: #0000ff\">bool</span><span style=\"color: #000000\"> Filter(MyContextEntity entity) {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> check for required components</span>\r\n<span style=\"color: #000000\">    }\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span> <span style=\"color: #0000ff\">void</span> Execute(List&lt;MyContextEntity&gt;<span style=\"color: #000000\"> entities) {\r\n        </span><span style=\"color: #0000ff\">foreach</span> (<span style=\"color: #0000ff\">var</span> e <span style=\"color: #0000ff\">in</span><span style=\"color: #000000\"> entities) {\r\n            </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> do stuff to the matched entities</span>\r\n<span style=\"color: #000000\">        }\r\n    }\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">要响应来自多个context的实体的更改，需要使用</span>multi-reactive system（<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">多响应系统）。首先，需要声明一个接口，该接口将组合来自具有相同组件的多个context的实体，并且需要通过部分类为实体类实现该接口。然后创建从MultiReactiveSystem继承的系统，并传递新接口。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">interface</span><span style=\"color: #000000\"> PositionViewEntity : IEntity, IPosition, IView {}\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">partial</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> EnemyEntity : PositionViewEntity {}\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">partial</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> ProjectileEntity : PositionViewEntity {}\r\n\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span> ViewSystem : MultiReactiveSystem&lt;PositionViewEntity, Contexts&gt;<span style=\"color: #000000\"> {\r\n\r\n    </span><span style=\"color: #0000ff\">public</span> ViewSystem(Contexts contexts) : <span style=\"color: #0000ff\">base</span><span style=\"color: #000000\">(contexts) {}\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span><span style=\"color: #000000\"> ICollector[] GetTrigger(Contexts contexts) {\r\n        </span><span style=\"color: #0000ff\">return</span> <span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> ICollector[] {\r\n            contexts.Enemy.CreateCollector(EnemyMatcher.Position),\r\n            contexts.Projectile.CreateCollector(ProjectileMatcher.Position)\r\n        };\r\n    }\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span> <span style=\"color: #0000ff\">bool</span><span style=\"color: #000000\"> Filter(PositionViewEntityentity) {\r\n        </span><span style=\"color: #0000ff\">return</span> entity.hasView &amp;&amp;<span style=\"color: #000000\"> entity.hasPosition;\r\n    }\r\n\r\n    </span><span style=\"color: #0000ff\">protected</span> <span style=\"color: #0000ff\">override</span> <span style=\"color: #0000ff\">void</span> Execute(List&lt;PositionViewEntity&gt;<span style=\"color: #000000\"> entities) {\r\n        </span><span style=\"color: #0000ff\">foreach</span>(<span style=\"color: #0000ff\">var</span> e <span style=\"color: #0000ff\">in</span><span style=\"color: #000000\"> entities) {\r\n            e.View.transform.position </span>=<span style=\"color: #000000\"> e.Position.value;\r\n        }\r\n    }\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div id=\"4780-1534473208206\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4448-1534473208241\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; font-weight: bold\">Features</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">entitas为提供了Features来组织你的system。使用Features将相关system组合在一起。这有一个额外的好处，就是可以在Unity层次结构中为你的system分离可视化调试对象。现在可以在逻辑组中检查它们，而不是一次检查所有。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\"> Feature还可以帮助你在项目中执行更广泛的范例规则。功能的执行顺序由添加它们的顺序决定，把你的系统分成InputSystems: Feature, GameLogicSystems: Feature和RenderingSystems: Feature，然后按照这个顺序初始化它们，确保游戏逻辑不会被干扰。</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\"> Feature要求实现构造函数。使用Add()方法向Feature添加system。这里添加它们的顺序定义了它们在运行时的执行顺序。可以在GameController中使用Feature将systems组实例化。</span></div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #0000ff\">using</span><span style=\"color: #000000\"> Entitas;\r\n\r\n</span><span style=\"color: #0000ff\">public</span> <span style=\"color: #0000ff\">class</span><span style=\"color: #000000\"> InputSystems : Feature\r\n{\r\n    </span><span style=\"color: #0000ff\">public</span> InputSystems(Contexts contexts) : <span style=\"color: #0000ff\">base</span>(<span style=\"color: #800000\">\"</span><span style=\"color: #800000\">Input Systems</span><span style=\"color: #800000\">\"</span><span style=\"color: #000000\">)\r\n    {\r\n        </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> order is respected </span>\r\n        Add(<span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> EmitInputSystem(contexts));\r\n        Add(</span><span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> ProcessInputSystem(contexts));\r\n    }\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">在你的GameController中：</div>\r\n<div>\r\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\r\n<pre><span style=\"color: #000000\">Systems createSystems(Contexts contexts) {\r\n\r\n     </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> order is respected</span>\r\n     <span style=\"color: #0000ff\">return</span> <span style=\"color: #0000ff\">new</span> Feature(<span style=\"color: #800000\">\"</span><span style=\"color: #800000\">Systems</span><span style=\"color: #800000\">\"</span><span style=\"color: #000000\">)\r\n\r\n         </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> Input executes first</span>\r\n         .Add(<span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> InputSystems(contexts))\r\n         </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> Update </span>\r\n         .Add(<span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> GameBoardSystems(contexts))\r\n         .Add(</span><span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> GameStateSystems(contexts))\r\n         </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> Render executes after game logic </span>\r\n         .Add(<span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> ViewSystems(contexts))\r\n         </span><span style=\"color: #008000\">//</span><span style=\"color: #008000\"> Destroy executes last</span>\r\n         .Add(<span style=\"color: #0000ff\">new</span><span style=\"color: #000000\"> DestroySystem(contexts));\r\n}</span></pre>\r\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\r\n<p>&nbsp;</p>\r\n</div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"7197-1534477492663\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-weight: bold\">entitas中的Attributes</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">Code Generator（<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">代码生成器）目前支持与类、接口和结构一起使用的以下特性：</span></div>\r\n<ul>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[Context]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">可以使用此特性使组件仅在指定的context中可用</span>;例如 <span style=\"font-family: monospace\">[MyContextName]</span>, <span style=\"font-family: monospace\">[Enemies]</span>, <span style=\"font-family: monospace\">[UI]</span>....<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">提高内存占用。它还可以创建组件。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[Unique]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">代码生成器将提供额外的方法，以确保最多存在一个具有该组件的实体。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[FlagPrefix]</span>:<span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">仅可用于支持标记组件的自定义前缀。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[PrimaryEntityIndex]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">可用于将实体限制为唯一的组件值。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[EntityIndex]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">可用于搜索具有组件值的实体。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[CustomComponentName]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">为一个类或接口生成具有不同名称的多个组件。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[DontGenerate]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">代码生成器不会使用此属性处理组件。</span></li>\r\n<li style=\"line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: bold; font-style: normal; text-decoration: none\"><span style=\"font-weight: bold\">[Cleanup]</span>: <span style=\"font-family: Arial; color: #2e3033; background-color: #ffffff\">代码生成器将生成删除组件或销毁实体的系统。</span></li>\r\n</ul>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\">这些特性的具体使用可以参考<a href=\"https://github.com/sschmid/Entitas-CSharp/wiki/Attributes\"><span style=\"color: #003884; text-decoration: underline\">https://github.com/sschmid/Entitas-CSharp/wiki/Attributes</span></a></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div id=\"5067-1534478002087\" style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 20px; font-weight: bold\">Code Generator代码生成</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.5; text-indent: 28px; font-size: 14px\">code generator是entitas框架的一大特色，可以让我们在开发时少写一些代码，在unity编辑器project面板中，<span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">Generated目录下都是自动生成的文件，不要去修改它们。</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.5; text-indent: 28px; font-size: 14px\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\"> 官方文档中介绍说可以自定义以及扩展code generator，让codegenerator更好的为我们服务，这一点我暂时没有去尝试。</span></div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.5; text-indent: 28px; font-size: 14px\">&nbsp;</div>\r\n<div id=\"4420-1534478416359\" style=\"white-space: pre-wrap; text-align: left; line-height: 1.5; font-size: 14px\"><span style=\"font-size: 20px; font-family: Arial; background-color: #ffffff; font-weight: bold\">个人看法</span></div>\r\n<div style=\"white-space: pre-wrap; line-height: 1.75; font-size: 14px\">以下是个人愚见，如有错误欢迎指正。</div>\r\n<div id=\"2591-1534478508703\" style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; background-color: #ffffff; font-weight: bold\">优点：</span></div>\r\n<ul>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">遵循这个框架的规则去写代码，代码结构清晰。</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">ECS这种模式，耦合度就很低，所有的游戏物体都是组件的组合而已，可扩展性强，通过合理组合component就能配置出一个新的游戏物体。</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">很方便的管理所有实体状态，entitas提供了类似状态机的功能，当感兴趣的某个属性发生变化时，能在System中很方便的做出响应，不管什么状态，都能很方便的做出对应处理。</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">unity本身的开发模式就类似ECS，unity2018更是推出了最新的ECS框架，entitas很符合这种开发模式</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">entitas自开源以来，一直在更新维护，并受到了unity官方的认可，在unite大会上都有提到。所以，这个框架还是很靠谱的。</span></li>\r\n</ul>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\"><span style=\"font-size: 16px; background-color: #ffffff; font-weight: bold\">缺点：</span></div>\r\n<ul>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">国内资料少，上手难度高。国内用这个框架开发的特别少，遇到问题需要自己爬坑。</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">不适合小项目。小项目用entitas反而麻烦</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: Arial; color: #666666; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\"><span style=\"font-family: Arial; color: #666666; background-color: #ffffff\">entitas更新太快，官方wiki文档更新没有跟上，比如，我在看官方Demo-MatchOne的时候，有个Event的Attribute， wiki上暂时还没有这个的</span></li>\r\n<li style=\"text-align: left; line-height: 1.75; font-size: 14px; list-style-position: inside; white-space: pre-wrap; list-style-type: disc; font-family: &quot;Microsoft YaHei&quot;, STXihei; color: #000000; background-color: transparent; font-weight: normal; font-style: normal; text-decoration: none\">代码热更方面是个问题， entitas基本对unity开发定了一套完整的规则，特别是有Code Generate，如果项目发布后想要更新加入新的代码会很麻烦，官方对此也没有说明，目前好像也没有人分享在entitas中加入lua热更的功能</li>\r\n</ul>\r\n<div style=\"white-space: pre-wrap; text-align: left; line-height: 1.75; font-size: 14px\">&nbsp;</div>\r\n</div></div>', '2');
INSERT INTO `blog_articledetail` VALUES ('3', '<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n <span style=\"font-weight:700;\">\n  将进酒\n </span>\n <span class=\"normal\" style=\"font-size:12px;line-height:0;vertical-align:baseline;\">\n  ⑴\n </span>\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n <a class=\"lemma-album layout-right nslog:10000206\" href=\"https://baike.baidu.com/pic/%E5%B0%86%E8%BF%9B%E9%85%92/5312/3119777/72f082025aafa40f63f533ccaa64034f78f019eb?fr=lemma&amp;ct=cover\" target=\"_blank\">\n  <div class=\"album-wrap\" style=\"border:1px solid #E0E0E0;\">\n   <img alt=\"书法作品《将进酒》\" class=\"picture\" src=\"https://gss0.bdstatic.com/94o3dSag_xI4khGkpoWK1HF6hhy/baike/s%3D220/sign=58c1f3e69e3df8dca23d8893fd1172bf/72f082025aafa40f63f533ccaa64034f78f019eb.jpg\" style=\"width:154px;height:220px;\"/>\n  </div>\n  <div class=\"albumBg\">\n   <div class=\"albumBgFir\" style=\"margin:0px auto;\">\n   </div>\n   <div class=\"albumBgSec\" style=\"margin:0px auto;\">\n   </div>\n  </div>\n </a>\n 君不见，黄河之水天上来，奔流到海不复回。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 君不见，高堂明镜悲白发，朝如青丝暮成雪。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 人生得意须尽欢，莫使金樽空对月。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 天生我材必有用，千金散尽还复来。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 烹羊宰牛且为乐，会须一饮三百杯。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 岑夫子，丹丘生，将进酒，杯莫停。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 与君歌一曲，请君为我倾耳听。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 钟鼓馔玉不足贵，但愿长醉不复醒。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 古来圣贤皆寂寞，惟有饮者留其名。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 陈王昔时宴平乐，斗酒十千恣欢谑。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 主人何为言少钱，径须沽取对君酌。\n</div>\n<div class=\"para\" style=\"font-size:14px;color:#333333;font-family:arial, 宋体, sans-serif;background-color:#FFFFFF;\">\n 五花马\n <span class=\"normal\" style=\"font-size:12px;line-height:0;vertical-align:baseline;\">\n  ⒂\n </span>\n ，千金裘，呼儿将出换美酒，与尔同销万古愁。\n</div>', '5');

-- ----------------------------
-- Table structure for `blog_articleupdown`
-- ----------------------------
DROP TABLE IF EXISTS `blog_articleupdown`;
CREATE TABLE `blog_articleupdown` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `is_up` tinyint(1) NOT NULL,
  `article_id` int(11) DEFAULT NULL,
  `user_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `blog_articleupdown_article_id_user_id_fa3d0c08_uniq` (`article_id`,`user_id`),
  KEY `blog_articleupdown_user_id_2c0ebe49_fk_blog_userinfo_id` (`user_id`),
  CONSTRAINT `blog_articleupdown_article_id_9be1a8a2_fk_blog_article_id` FOREIGN KEY (`article_id`) REFERENCES `blog_article` (`id`),
  CONSTRAINT `blog_articleupdown_user_id_2c0ebe49_fk_blog_userinfo_id` FOREIGN KEY (`user_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_articleupdown
-- ----------------------------
INSERT INTO `blog_articleupdown` VALUES ('6', '1', '2', '7');
INSERT INTO `blog_articleupdown` VALUES ('7', '0', '1', '7');
INSERT INTO `blog_articleupdown` VALUES ('8', '0', '1', '4');
INSERT INTO `blog_articleupdown` VALUES ('9', '1', '2', '4');
INSERT INTO `blog_articleupdown` VALUES ('10', '1', '3', '4');
INSERT INTO `blog_articleupdown` VALUES ('11', '1', '4', '4');
INSERT INTO `blog_articleupdown` VALUES ('12', '1', '5', '4');
INSERT INTO `blog_articleupdown` VALUES ('13', '1', '5', '7');

-- ----------------------------
-- Table structure for `blog_blog`
-- ----------------------------
DROP TABLE IF EXISTS `blog_blog`;
CREATE TABLE `blog_blog` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(64) NOT NULL,
  `theme` varchar(32) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_blog
-- ----------------------------
INSERT INTO `blog_blog` VALUES ('1', '超人的博客', 'super-man.css');
INSERT INTO `blog_blog` VALUES ('2', 'david的博客', 'david.css');

-- ----------------------------
-- Table structure for `blog_category`
-- ----------------------------
DROP TABLE IF EXISTS `blog_category`;
CREATE TABLE `blog_category` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(32) NOT NULL,
  `blog_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `blog_category_blog_id_80f0723a_fk_blog_blog_id` (`blog_id`),
  CONSTRAINT `blog_category_blog_id_80f0723a_fk_blog_blog_id` FOREIGN KEY (`blog_id`) REFERENCES `blog_blog` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_category
-- ----------------------------
INSERT INTO `blog_category` VALUES ('1', '技术', '1');
INSERT INTO `blog_category` VALUES ('2', '心理', '1');
INSERT INTO `blog_category` VALUES ('3', '讲座', '2');
INSERT INTO `blog_category` VALUES ('4', '技术', '2');

-- ----------------------------
-- Table structure for `blog_comment`
-- ----------------------------
DROP TABLE IF EXISTS `blog_comment`;
CREATE TABLE `blog_comment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `content` varchar(255) NOT NULL,
  `create_time` datetime(6) NOT NULL,
  `article_id` int(11) NOT NULL,
  `parent_comment_id` int(11) DEFAULT NULL,
  `user_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `blog_comment_article_id_3d58bca6_fk_blog_article_id` (`article_id`),
  KEY `blog_comment_parent_comment_id_26791b9a_fk_blog_comment_id` (`parent_comment_id`),
  KEY `blog_comment_user_id_59a54155_fk_blog_userinfo_id` (`user_id`),
  CONSTRAINT `blog_comment_article_id_3d58bca6_fk_blog_article_id` FOREIGN KEY (`article_id`) REFERENCES `blog_article` (`id`),
  CONSTRAINT `blog_comment_parent_comment_id_26791b9a_fk_blog_comment_id` FOREIGN KEY (`parent_comment_id`) REFERENCES `blog_comment` (`id`),
  CONSTRAINT `blog_comment_user_id_59a54155_fk_blog_userinfo_id` FOREIGN KEY (`user_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=34 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_comment
-- ----------------------------
INSERT INTO `blog_comment` VALUES ('1', '写得不错，给力！', '2018-08-20 15:09:56.420065', '2', null, '4');
INSERT INTO `blog_comment` VALUES ('2', '博主，做个朋友呗', '2018-08-20 15:10:35.337175', '2', null, '6');
INSERT INTO `blog_comment` VALUES ('3', '有哥的风范！', '2018-08-20 15:10:59.157940', '2', null, '5');
INSERT INTO `blog_comment` VALUES ('4', '怎奈何孤就是如此优秀！\n', '2018-08-20 16:30:56.331755', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('5', '没想到楼主竟是如此厚颜无耻之人！', '2018-08-20 16:36:03.047994', '2', '4', '6');
INSERT INTO `blog_comment` VALUES ('6', '我就是这么六！\n                ', '2018-08-20 17:14:35.374846', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('7', '孤天纵之资，尔等萤火虫也敢与日月争辉！\n            ', '2018-08-20 17:19:21.202712', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('8', '我说的都对，别反驳我！', '2018-08-20 17:49:53.553675', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('9', '啦啦啦', '2018-08-20 17:53:28.845024', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('10', '牛逼', '2018-08-20 18:01:41.129143', '2', '3', '7');
INSERT INTO `blog_comment` VALUES ('11', '不做，你奈何我何？', '2018-08-20 19:01:45.329265', '2', '2', '7');
INSERT INTO `blog_comment` VALUES ('12', '你好屌啊！', '2018-08-20 19:07:50.909209', '2', '11', '7');
INSERT INTO `blog_comment` VALUES ('13', '你屌你屌！', '2018-08-20 19:09:54.223788', '2', '12', '7');
INSERT INTO `blog_comment` VALUES ('14', '你屌你屌！', '2018-08-20 19:09:56.293506', '2', '12', '7');
INSERT INTO `blog_comment` VALUES ('15', '我是买包的小画家', '2018-08-20 19:11:31.624427', '2', '9', '7');
INSERT INTO `blog_comment` VALUES ('16', '我不买，我不买', '2018-08-20 19:15:26.118104', '2', '15', '7');
INSERT INTO `blog_comment` VALUES ('17', '哈哈哈', '2018-08-20 19:26:34.367970', '2', '9', '7');
INSERT INTO `blog_comment` VALUES ('18', '我很强大', '2018-08-20 19:53:04.125109', '2', '17', '7');
INSERT INTO `blog_comment` VALUES ('19', '\n             牛逼如我', '2018-08-20 19:53:51.925487', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('20', '妈呀呀\n                ', '2018-08-20 19:54:28.540795', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('21', '了不起', '2018-08-20 19:55:39.258967', '2', '20', '7');
INSERT INTO `blog_comment` VALUES ('22', '强大', '2018-08-20 19:57:16.288835', '2', '21', '7');
INSERT INTO `blog_comment` VALUES ('23', '强大', '2018-08-20 19:59:25.642670', '2', '22', '7');
INSERT INTO `blog_comment` VALUES ('24', '强大', '2018-08-20 20:01:47.559722', '2', '23', '7');
INSERT INTO `blog_comment` VALUES ('25', '@super-man\n老拉风了', '2018-08-20 20:02:38.114391', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('26', '发送到', '2018-08-20 20:03:22.459910', '2', '25', '7');
INSERT INTO `blog_comment` VALUES ('27', '艾弗森\n                ', '2018-08-20 20:03:43.974577', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('28', '@super-man\n艾弗森', '2018-08-20 20:03:49.530133', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('29', '艾弗森放散阀', '2018-08-20 20:04:13.260428', '2', '28', '7');
INSERT INTO `blog_comment` VALUES ('30', '萨法', '2018-08-20 20:05:33.900451', '2', '29', '7');
INSERT INTO `blog_comment` VALUES ('31', '舒服', '2018-08-20 20:07:26.696548', '2', '30', '7');
INSERT INTO `blog_comment` VALUES ('32', '待到阴阳逆乱时，\n以我魔血染青天！\n                ', '2018-08-20 21:00:46.575489', '2', null, '7');
INSERT INTO `blog_comment` VALUES ('33', '楼主霸气！', '2018-08-20 21:01:44.465613', '2', '32', '4');

-- ----------------------------
-- Table structure for `blog_tag`
-- ----------------------------
DROP TABLE IF EXISTS `blog_tag`;
CREATE TABLE `blog_tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(32) NOT NULL,
  `blog_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `blog_tag_blog_id_a8c60c42_fk_blog_blog_id` (`blog_id`),
  CONSTRAINT `blog_tag_blog_id_a8c60c42_fk_blog_blog_id` FOREIGN KEY (`blog_id`) REFERENCES `blog_blog` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_tag
-- ----------------------------
INSERT INTO `blog_tag` VALUES ('1', 'python基础', '1');
INSERT INTO `blog_tag` VALUES ('2', 'django基础', '1');
INSERT INTO `blog_tag` VALUES ('3', '技术', '2');
INSERT INTO `blog_tag` VALUES ('4', '精品', '2');

-- ----------------------------
-- Table structure for `blog_userinfo`
-- ----------------------------
DROP TABLE IF EXISTS `blog_userinfo`;
CREATE TABLE `blog_userinfo` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `password` varchar(128) NOT NULL,
  `last_login` datetime(6) DEFAULT NULL,
  `is_superuser` tinyint(1) NOT NULL,
  `username` varchar(150) NOT NULL,
  `first_name` varchar(30) NOT NULL,
  `last_name` varchar(30) NOT NULL,
  `email` varchar(254) NOT NULL,
  `is_staff` tinyint(1) NOT NULL,
  `is_active` tinyint(1) NOT NULL,
  `date_joined` datetime(6) NOT NULL,
  `phone` varchar(11) DEFAULT NULL,
  `avatar` varchar(100) NOT NULL,
  `blog_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `phone` (`phone`),
  UNIQUE KEY `blog_id` (`blog_id`),
  CONSTRAINT `blog_userinfo_blog_id_aa34488f_fk_blog_blog_id` FOREIGN KEY (`blog_id`) REFERENCES `blog_blog` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_userinfo
-- ----------------------------
INSERT INTO `blog_userinfo` VALUES ('4', 'pbkdf2_sha256$36000$g6zrt1AqNUCf$M2sVbnQF/R/r5b/MpcSbfG3QLSg2RTAW404UGlc3a+w=', '2018-08-22 11:44:49.223755', '1', 'david', '', '', '18758268124@163.com', '0', '1', '2018-08-14 12:58:00.000000', '13311112222', 'avatars/刺客.jpg', '2');
INSERT INTO `blog_userinfo` VALUES ('5', 'pbkdf2_sha256$36000$5ydbA82JxXwu$/A9bWHJchA3Pa/f9gl0EslaNaapqzdmA4e8NpS0QcX8=', '2018-08-19 18:38:53.040653', '0', 'Brave-man', '', '', '18758368124@163.com', '0', '1', '2018-08-14 13:00:42.010775', '13411113333', 'avatars/悟空.jpg', null);
INSERT INTO `blog_userinfo` VALUES ('6', 'pbkdf2_sha256$36000$27O5j76E78eC$NaAWUnyRlboqSkZKtIl0CS7X9sspqX+U8Zz+/J+g99k=', '2018-08-14 13:14:42.114854', '0', '百里守约', '', '', '13344442222@163.com', '0', '1', '2018-08-14 13:06:54.717869', '13344442222', 'avatars/刺客2.jpg', null);
INSERT INTO `blog_userinfo` VALUES ('7', 'pbkdf2_sha256$36000$hvEPwx872Mkh$st1QkRHMxErrd9MoZByOHDyg7+Wv41L0mqetoeh+Jwg=', '2018-08-22 12:59:44.225794', '1', 'super-man', '', '', '', '1', '1', '2018-08-15 02:22:00.000000', '18758268124', 'avatars/狼头_gsDfbuV.jpg', '1');

-- ----------------------------
-- Table structure for `blog_userinfo_groups`
-- ----------------------------
DROP TABLE IF EXISTS `blog_userinfo_groups`;
CREATE TABLE `blog_userinfo_groups` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `userinfo_id` int(11) NOT NULL,
  `group_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `blog_userinfo_groups_userinfo_id_group_id_5f60ecec_uniq` (`userinfo_id`,`group_id`),
  KEY `blog_userinfo_groups_group_id_1fb5e93a_fk_auth_group_id` (`group_id`),
  CONSTRAINT `blog_userinfo_groups_group_id_1fb5e93a_fk_auth_group_id` FOREIGN KEY (`group_id`) REFERENCES `auth_group` (`id`),
  CONSTRAINT `blog_userinfo_groups_userinfo_id_f6f0498b_fk_blog_userinfo_id` FOREIGN KEY (`userinfo_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_userinfo_groups
-- ----------------------------

-- ----------------------------
-- Table structure for `blog_userinfo_user_permissions`
-- ----------------------------
DROP TABLE IF EXISTS `blog_userinfo_user_permissions`;
CREATE TABLE `blog_userinfo_user_permissions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `userinfo_id` int(11) NOT NULL,
  `permission_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `blog_userinfo_user_permi_userinfo_id_permission_i_7d343093_uniq` (`userinfo_id`,`permission_id`),
  KEY `blog_userinfo_user_p_permission_id_ace80f7e_fk_auth_perm` (`permission_id`),
  CONSTRAINT `blog_userinfo_user_p_permission_id_ace80f7e_fk_auth_perm` FOREIGN KEY (`permission_id`) REFERENCES `auth_permission` (`id`),
  CONSTRAINT `blog_userinfo_user_p_userinfo_id_57e76697_fk_blog_user` FOREIGN KEY (`userinfo_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of blog_userinfo_user_permissions
-- ----------------------------

-- ----------------------------
-- Table structure for `django_admin_log`
-- ----------------------------
DROP TABLE IF EXISTS `django_admin_log`;
CREATE TABLE `django_admin_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `action_time` datetime(6) NOT NULL,
  `object_id` longtext,
  `object_repr` varchar(200) NOT NULL,
  `action_flag` smallint(5) unsigned NOT NULL,
  `change_message` longtext NOT NULL,
  `content_type_id` int(11) DEFAULT NULL,
  `user_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `django_admin_log_content_type_id_c4bce8eb_fk_django_co` (`content_type_id`),
  KEY `django_admin_log_user_id_c564eba6_fk_blog_userinfo_id` (`user_id`),
  CONSTRAINT `django_admin_log_content_type_id_c4bce8eb_fk_django_co` FOREIGN KEY (`content_type_id`) REFERENCES `django_content_type` (`id`),
  CONSTRAINT `django_admin_log_user_id_c564eba6_fk_blog_userinfo_id` FOREIGN KEY (`user_id`) REFERENCES `blog_userinfo` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=41 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of django_admin_log
-- ----------------------------
INSERT INTO `django_admin_log` VALUES ('1', '2018-08-15 02:25:23.653225', '1', '超人的博客', '1', '[{\"added\": {}}]', '11', '7');
INSERT INTO `django_admin_log` VALUES ('2', '2018-08-15 02:25:27.822832', '1', '超人的博客-技术', '1', '[{\"added\": {}}]', '12', '7');
INSERT INTO `django_admin_log` VALUES ('3', '2018-08-15 02:25:36.285974', '1', 'String 的常用操作', '1', '[{\"added\": {}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('4', '2018-08-15 02:26:37.571368', '2', '超人的博客-心理', '1', '[{\"added\": {}}]', '12', '7');
INSERT INTO `django_admin_log` VALUES ('5', '2018-08-15 02:26:48.440979', '2', '一个程序员的自白（浅水淹人）', '1', '[{\"added\": {}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('6', '2018-08-15 09:34:19.761106', '2', 'david的博客', '1', '[{\"added\": {}}]', '11', '7');
INSERT INTO `django_admin_log` VALUES ('7', '2018-08-15 09:35:07.082311', '4', 'david', '2', '[{\"changed\": {\"fields\": [\"last_login\", \"is_superuser\", \"blog\"]}}]', '6', '7');
INSERT INTO `django_admin_log` VALUES ('8', '2018-08-15 09:35:34.153883', '7', 'super-man', '2', '[{\"changed\": {\"fields\": [\"last_login\", \"phone\", \"blog\"]}}]', '6', '7');
INSERT INTO `django_admin_log` VALUES ('9', '2018-08-15 11:10:56.408259', '1', 'python基础', '1', '[{\"added\": {}}]', '14', '7');
INSERT INTO `django_admin_log` VALUES ('10', '2018-08-15 11:11:14.927637', '2', 'django基础', '1', '[{\"added\": {}}]', '14', '7');
INSERT INTO `django_admin_log` VALUES ('11', '2018-08-15 11:12:23.521480', '1', 'String 的常用操作-python基础', '1', '[{\"added\": {}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('12', '2018-08-15 11:12:29.428297', '1', '一个程序员的自白（浅水淹人）-django基础', '2', '[{\"changed\": {\"fields\": [\"article\", \"tag\"]}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('13', '2018-08-15 11:12:30.694137', '1', '一个程序员的自白（浅水淹人）-django基础', '2', '[]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('14', '2018-08-15 11:23:43.735073', '2', 'String 的常用操作-python基础', '1', '[{\"added\": {}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('15', '2018-08-15 12:08:49.231427', '2', '一个程序员的自白（浅水淹人）', '2', '[{\"changed\": {\"fields\": [\"category\"]}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('16', '2018-08-15 12:17:55.789724', '3', 'david的博客-讲座', '1', '[{\"added\": {}}]', '12', '7');
INSERT INTO `django_admin_log` VALUES ('17', '2018-08-15 12:18:12.333923', '3', '如何快速分析出现性能问题的Linux服务器', '1', '[{\"added\": {}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('18', '2018-08-15 12:18:43.160339', '4', '入门系列之在Ubuntu上使用Netdata设置实时性能监控', '1', '[{\"added\": {}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('19', '2018-08-15 12:21:44.586954', '4', 'david的博客-技术', '1', '[{\"added\": {}}]', '12', '7');
INSERT INTO `django_admin_log` VALUES ('20', '2018-08-15 12:22:04.943074', '2', '一个程序员的自白（浅水淹人）', '2', '[{\"changed\": {\"fields\": [\"category\"]}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('21', '2018-08-15 14:31:05.338643', '7', 'super-man', '2', '[{\"changed\": {\"fields\": [\"last_login\", \"avatar\"]}}]', '6', '7');
INSERT INTO `django_admin_log` VALUES ('22', '2018-08-16 08:12:41.965787', '3', '如何快速分析出现性能问题的Linux服务器-python基础', '1', '[{\"added\": {}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('23', '2018-08-16 08:12:56.706611', '4', '入门系列之在Ubuntu上使用Netdata设置实时性能监控-django基础', '1', '[{\"added\": {}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('24', '2018-08-16 08:13:40.807556', '3', '技术', '1', '[{\"added\": {}}]', '14', '7');
INSERT INTO `django_admin_log` VALUES ('25', '2018-08-16 08:13:54.312766', '4', '精品', '1', '[{\"added\": {}}]', '14', '7');
INSERT INTO `django_admin_log` VALUES ('26', '2018-08-16 08:14:25.816171', '4', '入门系列之在Ubuntu上使用Netdata设置实时性能监控-技术', '2', '[{\"changed\": {\"fields\": [\"tag\"]}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('27', '2018-08-16 08:14:34.674856', '3', '如何快速分析出现性能问题的Linux服务器-精品', '2', '[{\"changed\": {\"fields\": [\"tag\"]}}]', '8', '7');
INSERT INTO `django_admin_log` VALUES ('28', '2018-08-16 08:15:21.585294', '2', '一个程序员的自白（浅水淹人）', '2', '[{\"changed\": {\"fields\": [\"user\"]}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('29', '2018-08-16 08:16:28.896502', '2', '一个程序员的自白（浅水淹人）', '2', '[{\"changed\": {\"fields\": [\"category\"]}}]', '7', '7');
INSERT INTO `django_admin_log` VALUES ('30', '2018-08-17 16:37:39.592164', '1', 'ArticleDetail object', '1', '[{\"added\": {}}]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('31', '2018-08-17 16:42:30.596304', '1', 'ArticleDetail object', '2', '[]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('32', '2018-08-17 16:43:13.701254', '1', 'ArticleDetail object', '2', '[]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('33', '2018-08-17 16:45:03.775377', '2', 'ArticleDetail object', '1', '[{\"added\": {}}]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('34', '2018-08-17 16:45:17.682752', '2', 'ArticleDetail object', '2', '[]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('35', '2018-08-17 16:49:29.409354', '2', 'ArticleDetail object', '2', '[{\"changed\": {\"fields\": [\"content\"]}}]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('36', '2018-08-17 16:50:20.170555', '1', 'ArticleDetail object', '2', '[{\"changed\": {\"fields\": [\"content\"]}}]', '9', '7');
INSERT INTO `django_admin_log` VALUES ('37', '2018-08-20 15:09:56.445047', '1', '写得不错，给力！', '1', '[{\"added\": {}}]', '13', '7');
INSERT INTO `django_admin_log` VALUES ('38', '2018-08-20 15:10:35.348168', '2', '博主，做个朋友呗', '1', '[{\"added\": {}}]', '13', '7');
INSERT INTO `django_admin_log` VALUES ('39', '2018-08-20 15:10:59.169933', '3', '有哥的风范！', '1', '[{\"added\": {}}]', '13', '7');
INSERT INTO `django_admin_log` VALUES ('40', '2018-08-20 16:36:03.057989', '5', '没想到楼主竟是如此厚颜无耻之人！', '1', '[{\"added\": {}}]', '13', '7');

-- ----------------------------
-- Table structure for `django_content_type`
-- ----------------------------
DROP TABLE IF EXISTS `django_content_type`;
CREATE TABLE `django_content_type` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `app_label` varchar(100) NOT NULL,
  `model` varchar(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `django_content_type_app_label_model_76bd3d3b_uniq` (`app_label`,`model`)
) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of django_content_type
-- ----------------------------
INSERT INTO `django_content_type` VALUES ('1', 'admin', 'logentry');
INSERT INTO `django_content_type` VALUES ('3', 'auth', 'group');
INSERT INTO `django_content_type` VALUES ('2', 'auth', 'permission');
INSERT INTO `django_content_type` VALUES ('7', 'blog', 'article');
INSERT INTO `django_content_type` VALUES ('8', 'blog', 'article2tag');
INSERT INTO `django_content_type` VALUES ('9', 'blog', 'articledetail');
INSERT INTO `django_content_type` VALUES ('10', 'blog', 'articleupdown');
INSERT INTO `django_content_type` VALUES ('11', 'blog', 'blog');
INSERT INTO `django_content_type` VALUES ('12', 'blog', 'category');
INSERT INTO `django_content_type` VALUES ('13', 'blog', 'comment');
INSERT INTO `django_content_type` VALUES ('14', 'blog', 'tag');
INSERT INTO `django_content_type` VALUES ('6', 'blog', 'userinfo');
INSERT INTO `django_content_type` VALUES ('4', 'contenttypes', 'contenttype');
INSERT INTO `django_content_type` VALUES ('5', 'sessions', 'session');

-- ----------------------------
-- Table structure for `django_migrations`
-- ----------------------------
DROP TABLE IF EXISTS `django_migrations`;
CREATE TABLE `django_migrations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `app` varchar(255) NOT NULL,
  `name` varchar(255) NOT NULL,
  `applied` datetime(6) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of django_migrations
-- ----------------------------
INSERT INTO `django_migrations` VALUES ('1', 'contenttypes', '0001_initial', '2018-08-13 07:33:58.797781');
INSERT INTO `django_migrations` VALUES ('2', 'contenttypes', '0002_remove_content_type_name', '2018-08-13 07:33:58.938694');
INSERT INTO `django_migrations` VALUES ('3', 'auth', '0001_initial', '2018-08-13 07:33:59.568305');
INSERT INTO `django_migrations` VALUES ('4', 'auth', '0002_alter_permission_name_max_length', '2018-08-13 07:33:59.674240');
INSERT INTO `django_migrations` VALUES ('5', 'auth', '0003_alter_user_email_max_length', '2018-08-13 07:33:59.683235');
INSERT INTO `django_migrations` VALUES ('6', 'auth', '0004_alter_user_username_opts', '2018-08-13 07:33:59.691228');
INSERT INTO `django_migrations` VALUES ('7', 'auth', '0005_alter_user_last_login_null', '2018-08-13 07:33:59.701228');
INSERT INTO `django_migrations` VALUES ('8', 'auth', '0006_require_contenttypes_0002', '2018-08-13 07:33:59.706220');
INSERT INTO `django_migrations` VALUES ('9', 'auth', '0007_alter_validators_add_error_messages', '2018-08-13 07:33:59.715215');
INSERT INTO `django_migrations` VALUES ('10', 'auth', '0008_alter_user_username_max_length', '2018-08-13 07:33:59.725208');
INSERT INTO `django_migrations` VALUES ('11', 'blog', '0001_initial', '2018-08-13 07:34:02.656398');
INSERT INTO `django_migrations` VALUES ('12', 'admin', '0001_initial', '2018-08-13 07:34:02.992191');
INSERT INTO `django_migrations` VALUES ('13', 'admin', '0002_logentry_remove_auto_add', '2018-08-13 07:34:03.013179');
INSERT INTO `django_migrations` VALUES ('14', 'sessions', '0001_initial', '2018-08-13 07:34:03.095129');
INSERT INTO `django_migrations` VALUES ('15', 'blog', '0002_auto_20180815_1533', '2018-08-15 07:34:02.424843');

-- ----------------------------
-- Table structure for `django_session`
-- ----------------------------
DROP TABLE IF EXISTS `django_session`;
CREATE TABLE `django_session` (
  `session_key` varchar(40) NOT NULL,
  `session_data` longtext NOT NULL,
  `expire_date` datetime(6) NOT NULL,
  PRIMARY KEY (`session_key`),
  KEY `django_session_expire_date_a5c62663` (`expire_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of django_session
-- ----------------------------
INSERT INTO `django_session` VALUES ('4jvyhi5mcyi7jqz5sh47ghki7vw8pccd', 'ZjY2MGM5N2UyODA0YmExYTNlZDdmMTdiMTVkYWNjMTYwZTgzODQwMDp7InZfY29kZSI6IjRKTklZIn0=', '2018-08-28 13:16:08.777271');
INSERT INTO `django_session` VALUES ('6alzqh3uihw5cswkt1alct9ve36b06sd', 'OTc4N2I5ODhhYjcwNDYzZTk3MDE3YzhmYmFhYmI2ZjM3ZGE3Nzc5YTp7InZfY29kZSI6IkRXOTRNIiwiX2F1dGhfdXNlcl9pZCI6IjciLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJkamFuZ28uY29udHJpYi5hdXRoLmJhY2tlbmRzLk1vZGVsQmFja2VuZCIsIl9hdXRoX3VzZXJfaGFzaCI6IjQyYTQwMThlNDdiN2MyOWU0MDM3NTFjZTEzZDBiNWYzNjA0MzM4OTAifQ==', '2018-09-05 12:59:44.233790');
INSERT INTO `django_session` VALUES ('a0m1qx7ebrw6w1hm24xj0g9hblfh44fj', 'YTUwNDA2ZTI3Yjg3MzkyMTg2NTM1ZDRiMGEzODI4NzViMWQwNGUyNDp7Il9hdXRoX3VzZXJfaWQiOiIxIiwiX2F1dGhfdXNlcl9iYWNrZW5kIjoiZGphbmdvLmNvbnRyaWIuYXV0aC5iYWNrZW5kcy5Nb2RlbEJhY2tlbmQiLCJfYXV0aF91c2VyX2hhc2giOiJiNTk5Mjg0MWMwNzZhMWE2ZTY1YTQxOWEwMGJlOGYyZTNmZDI0ZTkzIiwidl9jb2RlIjoiT1ZXSjYifQ==', '2018-08-27 11:22:05.576750');
INSERT INTO `django_session` VALUES ('atz5lqh39q6fj58pwf74buheor6pa913', 'YTM3Mjg3ZDIyNWM1ZWFmNzY5YzVkMzMyMzIyZmJjMjJjMTE2YWI1Yzp7InZfY29kZSI6IldFNTBPIn0=', '2018-09-02 18:59:42.999008');
INSERT INTO `django_session` VALUES ('k53rgxcg83sl43ee2sz3yevd59rgy5lm', 'ZWU2MmQzYzc2ZTA0Y2IwNzdiNzk4NDdjMjQyOGIxMDgwZGZiYTY0Mzp7InZfY29kZSI6IjZCOUI3IiwiX2F1dGhfdXNlcl9pZCI6IjEiLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJkamFuZ28uY29udHJpYi5hdXRoLmJhY2tlbmRzLk1vZGVsQmFja2VuZCIsIl9hdXRoX3VzZXJfaGFzaCI6ImI1OTkyODQxYzA3NmExYTZlNjVhNDE5YTAwYmU4ZjJlM2ZkMjRlOTMifQ==', '2018-08-27 12:24:50.173319');
INSERT INTO `django_session` VALUES ('t90dz3zj80j3p49wj7lw8fdtmk6j26oo', 'MmVhZmRmMDZiODgyNGRlMWJiZjFiOWRjZGYzNmE0ZjZmNWY2NjMyMzp7InZfY29kZSI6IjRPN0s3In0=', '2018-08-31 23:16:57.933104');
INSERT INTO `django_session` VALUES ('xjajz4je7u1wd6g803939fprtm8i4831', 'YTcxZmJlYjY5MzQxYjY5MThjM2JjM2EwNGFjODIyZDUwNjg5MTI0Zjp7InZfY29kZSI6Ik5IN1k1IiwiX2F1dGhfdXNlcl9pZCI6IjciLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJkamFuZ28uY29udHJpYi5hdXRoLmJhY2tlbmRzLk1vZGVsQmFja2VuZCIsIl9hdXRoX3VzZXJfaGFzaCI6IjQyYTQwMThlNDdiN2MyOWU0MDM3NTFjZTEzZDBiNWYzNjA0MzM4OTAifQ==', '2018-08-29 02:23:01.702249');
INSERT INTO `django_session` VALUES ('xkdg1vjs3dn8o8dpjd9ti93j3a1v2tr7', 'NzkyYzFmNmU1NWQ3Mzk1MjMyZGYwYmFmNTQxODU5NmQwMGEyNDViMjp7InZfY29kZSI6IkVETkQ5IiwiX2F1dGhfdXNlcl9pZCI6IjciLCJfYXV0aF91c2VyX2JhY2tlbmQiOiJkamFuZ28uY29udHJpYi5hdXRoLmJhY2tlbmRzLk1vZGVsQmFja2VuZCIsIl9hdXRoX3VzZXJfaGFzaCI6IjQyYTQwMThlNDdiN2MyOWU0MDM3NTFjZTEzZDBiNWYzNjA0MzM4OTAifQ==', '2018-08-29 07:14:39.836854');
